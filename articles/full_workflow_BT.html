<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Full Workflow Bildungstrend • eatCodebook</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Full Workflow Bildungstrend">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">eatCodebook</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/full_workflow_BT.html">Full Workflow Bildungstrend</a></li>
    <li><a class="dropdown-item" href="../articles/full_workflow.html">Full Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/minimal_example.html">Minimal Example</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/beckerbenj/eatCodebook/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Full Workflow Bildungstrend</h1>
                        <h4 data-toc-skip class="author">Edna
Grewers</h4>
            
            <h4 data-toc-skip class="date">2025-12-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/beckerbenj/eatCodebook/blob/main/vignettes/full_workflow_BT.Rmd" class="external-link"><code>vignettes/full_workflow_BT.Rmd</code></a></small>
      <div class="d-none name"><code>full_workflow_BT.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="intro">Intro<a class="anchor" aria-label="anchor" href="#intro"></a>
</h2>
<div class="section level3">
<h3 id="goal-of-the-vignette">Goal of the Vignette<a class="anchor" aria-label="anchor" href="#goal-of-the-vignette"></a>
</h3>
<p>This vignettes describes the full workflow of creating a codebook (or
Skalenhandbuch) via the <code>eatCodebook</code> package. For
illustrative purposes, we use a small example data set which comes
alongside the package and contains different types of variables (e.g.,
numeric, categorical, pooled variables, scales). We import the data set
using the <code>eatGADS</code> package, which is automatically installed
when <code>eatCodebook</code> is installed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/beckerbenj/eatCodebook" class="external-link">eatCodebook</a></span><span class="op">)</span></span>
<span><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"example2_clean.sav"</span>, package <span class="op">=</span> <span class="st">"eatCodebook"</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">eatGADS</span><span class="fu">::</span><span class="fu"><a href="https://beckerbenj.github.io/eatGADS/reference/import_spss.html" class="external-link">import_spss</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span></code></pre></div>
<p>The main function for creating a Skalenhandbuch or codebook is called
<code><a href="../reference/codebook.html">codebook()</a></code>. It takes the input from several lists and data
frames that you create throughout this vignette and converts them into
one long object containing LaTeX code. You have to be mindful of special
characters (like α and other Greek letters) in string input from the
data frames as they might throw errors down the line. Also, formatting
in Excel is lost in the LaTeX script, so you may need to add LaTeX code
to the Excel files. The most common occurrences are mentioned in this
vignette.</p>
<p>While working on the codebook, you will probably find some mismatches
or errors in the data. You then have to recreate every data frame or
Excel table you created so far, including the changes you made to those
objects. This vignette includes examples on how to write a script in R
that you can just rerun in those cases, without having to redo a lot of
work manually.</p>
</div>
<div class="section level3">
<h3 id="what-is-a-codebook">What is a Codebook?<a class="anchor" aria-label="anchor" href="#what-is-a-codebook"></a>
</h3>
<p>In order to answer research questions, research institutes collect a
lot of data. Usually the data isn’t used to answer all possible
questions, but just the ones of interest to the study they were
collected for. When people want to to do their own research, they can
ask the institutes for the data.<br>
A codebook contains documentation on <strong>all of the collected
variables</strong> of a study, ideally including their exact wording,
relevant descriptive statistics, references, and more. Codebooks enable
researchers to work with data sets they are not yet familiar with.
Furthermore, they should enable them to assess, whether data sets might
help them answer their research questions, before asking for the
data.</p>
</div>
<div class="section level3">
<h3 id="about-this-vignette">About this Vignette<a class="anchor" aria-label="anchor" href="#about-this-vignette"></a>
</h3>
<p>There are several chapters explaining how to create a codebook. Next
to the data you need additional information like the references or
instructions of the variables, the order they’re supposed to be
displayed in and more. Each chapter contains an <code>About</code>
section explaining the what and why of what you are doing and a
<code>To-do</code> section explaining how to do these things in
<code>R</code> step by step.</p>
<p>The package <code>eatCodebook</code> was created with the codebooks
for the <a href="https://www.iqb.hu-berlin.de/bt/" class="external-link">IQB Bildungstrend
studies</a> in mind. Some use cases are specific to these Bildungstrend
(BT) studies, but you can create a codebook for your own study with
<code>eatCodebook</code>, as well.</p>
<p>The example code in this vignette will focus on the creating of a BT
codebook, using the templates from a IQB methods team repository on
GitHub.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Before we start, we need to setup a proper work space. Creating a
codebook takes a while and involves several files, so without proper
tracking of the process it is easy to lose focus. When editing the files
in R, the script can get very long, so I recommend to use several .R
documents to maintain overview.</p>
<div class="section level3">
<h3 id="create-a-new-repository">Create a New Repository<a class="anchor" aria-label="anchor" href="#create-a-new-repository"></a>
</h3>
<p>First set up a new private repository in the <a href="https://github.com/orgs/iqb-research/repositories" class="external-link"><code>iqb-research</code>
project</a> and use the template <code>SHB_Erstellung_Vorlage</code>.
when you don’t have access to this repository, ask the package developer
for help or create your own repository.</p>
<p><img src=".%5Cpictures%5Crepo_template.png" style="width:50.0%"><br><img src="pictures/repo_template.png" alt="repo_template"><br><br></p>
<p>You now have all the .R templates that you need, but you might have
to create the issues yourself. The To-dos should be apparent from this
vignette or you can copy the issues from the template repo by hand. You
will find the following files:</p>
</div>
<div class="section level3">
<h3 id="file-structure">File Structure<a class="anchor" aria-label="anchor" href="#file-structure"></a>
</h3>
<p>There are several files and folders. The .R files contain example
scripts and to-dos, that you need to adjust and add to.</p>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>R File</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>0_main.R</code></td>
<td>The main file you work in. You can work with just this file and
ignore the others, if you want. I recommend using this file for smaller
changes and the separate files for more complex changes. With this file,
you can create Excel files which you then have to edit manually or in
R.</td>
</tr>
<tr class="even">
<td><code>1_kennwerte.R</code></td>
<td>Create and edit the <code>inputForDescriptives</code> files. This
might not be needed, when you don’t have to adjust anything here.</td>
</tr>
<tr class="odd">
<td><code>2_varinfo.R</code></td>
<td>Create and edit the <code>varinfo</code> file. This file contains
the <strong>core</strong> content of the codebook.
<code>eatCodebook()</code> creates the table structure with variable
names and labels on its own, but you have to add structure, references,
instructions, etc..</td>
</tr>
<tr class="even">
<td><code>3_gliederung.R</code></td>
<td>The information read from <code>varinfo</code> is usually
incomplete, so you have to add missing section names.</td>
</tr>
<tr class="odd">
<td><code>4_literatur.R</code></td>
<td>Create and edit the reference list. You have to match in-text
citations to their respective references.</td>
</tr>
<tr class="even">
<td><code>5_latex_intro.R</code></td>
<td>A template to create a .tex file with LaTeX syntax out of a Word
.docx document. You need this later when creating the intro.</td>
</tr>
<tr class="odd">
<td><code>6_Erstellung_kurz.R</code></td>
<td>A short script which can create a new codebook version after you
created all the necessary Excel files.</td>
</tr>
</tbody>
</table>
<p>You need to make sure that there are three folders and create them if
not.</p>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>Folder</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>excel_files</code></td>
<td>Here you save all of the created Excel files to save the progress.
In this vignette you also save two <code>.RDS</code> files in this
folder.</td>
</tr>
<tr class="even">
<td><code>Latex</code></td>
<td>Here you save the .tex files and pdfs of the finished LaTeX script
for the codebook. You can add the folder <code>archive</code> to keep
different versions to compare.</td>
</tr>
<tr class="odd">
<td><code>Texte</code></td>
<td>Here you can save the intro text, cover and other texts.</td>
</tr>
</tbody>
</table>
<p>Pull the repo and start with the file <strong>0_main.R</strong>. You
usually don’t need to copy any code from this vignette, because the
template already contains example code lines that you can copy or
adjust.</p>
</div>
<div class="section level3">
<h3 id="packages">Packages<a class="anchor" aria-label="anchor" href="#packages"></a>
</h3>
<p>You need to make sure you have the latest package versions installed.
The packages you need are usually at the top of the files in
<code>setup</code>. To save time you can install them before you start
your work.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># main</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"beckerbenj/eatCodebook"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/beckerbenj/eatCodebook" class="external-link">eatCodebook</a></span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"beckerbenj/eatGADS"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/beckerbenj/eatGADS" class="external-link">eatGADS</a></span><span class="op">)</span></span>
<span><span class="co"># varinfo</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"weirichs/eatTools"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/weirichs/eatTools" class="external-link">eatTools</a></span><span class="op">)</span></span>
<span><span class="co"># references</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"tidyxl"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nacnudus/tidyxl" class="external-link">tidyxl</a></span><span class="op">)</span></span>
<span><span class="co"># latex_intro</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"readtext"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readtext.quanteda.io/" class="external-link">readtext</a></span><span class="op">)</span></span></code></pre></div>
<p>After you set up your work space, you can now start creating the
codebook step by step.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="import-data">1. Import Data<a class="anchor" aria-label="anchor" href="#import-data"></a>
</h2>
<p>The first step is the data import.</p>
<div class="section level3">
<h3 id="about-the-data">About the Data<a class="anchor" aria-label="anchor" href="#about-the-data"></a>
</h3>
<p>The BT studies usually have several SPSS data files
(<code>.sav</code>) that you can import with <code><a href="https://beckerbenj.github.io/eatGADS/reference/import_spss.html" class="external-link">import_spss()</a></code>,
but you can also import <code>.RDS</code> files with
<code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS()</a></code>. If you work with Github, the data sets are
probably too large to upload to Github, so they would need to be stored
locally. The BT codebook works with multiple data sets that are stored
in a list. But the process should also work if you have only one data
set.</p>
<blockquote>
<p>The same variable name cannot be used more than once across the data
sets!</p>
</blockquote>
<p>The data sets can be stored in <code>GADSdat</code> objects,
containing two data frames: one for the variables and the actual data,
the other contains the meta data or labels for the variables.</p>
<div class="section level4">
<h4 id="order-of-the-data-sets">Order of the Data Sets<a class="anchor" aria-label="anchor" href="#order-of-the-data-sets"></a>
</h4>
<p>You have to save all the data sets in one list that also determines
the order in which the variables are displayed in the codebook. It’s
best to choose the order you want right away, so you don’t have to make
changes later.</p>
<blockquote>
<p>In the past the BT data sets were ordered like this:</p>
<ul>
<li>
<strong>data_sus</strong>: student questionnaire</li>
<li>
<strong>data_lfb_allg</strong>: general teacher questionnaire</li>
<li>
<strong>data_lfb_spez</strong>: learngroup specific teacher
questionnaire</li>
<li>
<strong>data_slfb</strong>: school administration questionnaire</li>
<li>
<strong>data_match</strong>: data to match different data sets</li>
</ul>
<p>It’s best to ask the BT team about the final order.</p>
</blockquote>
<p>There might also be a data set called <em>linking errors</em>
(Linkingfehler), but that’s usually not displayed in the final codebook.
If not told otherwise, you can ignore this for creating the
codebook.</p>
</div>
</div>
<div class="section level3">
<h3 id="data-import-to-do">Data Import To-do<a class="anchor" aria-label="anchor" href="#data-import-to-do"></a>
</h3>
<p>Open the file <strong>0_main.R</strong>. You need to make sure the
packages <code>eatCodebook</code> and <code>eatGADS</code> are
loaded.</p>
<div class="section level4">
<h4 id="import-the-data">Import the Data<a class="anchor" aria-label="anchor" href="#import-the-data"></a>
</h4>
<p>Either use <code><a href="https://beckerbenj.github.io/eatGADS/reference/import_spss.html" class="external-link">import_spss()</a></code> for .sav (SPSS) files or
<code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS()</a></code> to import each data set separately, you just need
a string with your local file path. Name them in a meaningful manner.
Here you have an example syntax, where you would need to adjust the
<strong>file name</strong>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_sus</span>      <span class="op">&lt;-</span> <span class="fu">eatGADS</span><span class="fu">::</span><span class="fu"><a href="https://beckerbenj.github.io/eatGADS/reference/import_spss.html" class="external-link">import_spss</a></span><span class="op">(</span><span class="st">"Q:\\filepath\\Daten_sus.sav"</span><span class="op">)</span></span>
<span><span class="va">data_lfb_allg</span> <span class="op">&lt;-</span> <span class="fu">eatGADS</span><span class="fu">::</span><span class="fu"><a href="https://beckerbenj.github.io/eatGADS/reference/import_spss.html" class="external-link">import_spss</a></span><span class="op">(</span><span class="st">"Q:\\filepath\\Daten_lfb_allg.sav"</span><span class="op">)</span></span>
<span><span class="va">data_lfb_spez</span> <span class="op">&lt;-</span> <span class="fu">eatGADS</span><span class="fu">::</span><span class="fu"><a href="https://beckerbenj.github.io/eatGADS/reference/import_spss.html" class="external-link">import_spss</a></span><span class="op">(</span><span class="st">"Q:\\filepath\\Daten_lfb_spez.sav"</span><span class="op">)</span></span>
<span><span class="va">data_slfb</span>     <span class="op">&lt;-</span> <span class="fu">eatGADS</span><span class="fu">::</span><span class="fu"><a href="https://beckerbenj.github.io/eatGADS/reference/import_spss.html" class="external-link">import_spss</a></span><span class="op">(</span><span class="st">"Q:\\filepath\\Daten_slfb.sav"</span><span class="op">)</span></span>
<span><span class="va">data_match</span>    <span class="op">&lt;-</span> <span class="fu">eatGADS</span><span class="fu">::</span><span class="fu"><a href="https://beckerbenj.github.io/eatGADS/reference/import_spss.html" class="external-link">import_spss</a></span><span class="op">(</span><span class="st">"Q:\\filepath\\Daten_match.sav"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="save-data-in-a-list">Save Data in a List<a class="anchor" aria-label="anchor" href="#save-data-in-a-list"></a>
</h4>
<p>After importing the data, you need to save it in one list
<code>datalist</code>. The order determines the order in which they are
displayed in the codebook. The names should be consistent
throughout.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datalist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sus <span class="op">=</span> <span class="va">data_sus</span>,</span>
<span>                 lfb_allg <span class="op">=</span> <span class="va">data_lfb_allg</span>, lfb_spez <span class="op">=</span> <span class="va">data_lfb_spez</span>,</span>
<span>                 slfb <span class="op">=</span> <span class="va">data_slfb</span>, match <span class="op">=</span> <span class="va">data_match</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="descriptive-statistics">2. Descriptive Statistics<a class="anchor" aria-label="anchor" href="#descriptive-statistics"></a>
</h2>
<p>Now you have the raw data, but you want the descriptive statistics
for the codebook, not just the data sets.</p>
<div class="section level3">
<h3 id="about-descriptive-statistics">About Descriptive Statistics<a class="anchor" aria-label="anchor" href="#about-descriptive-statistics"></a>
</h3>
<p>One of the key elements of a codebook are descriptive statistics
shortly describing each variable in the data set. What kind of
descriptive statistics is reported for each variable depends on the type
of the variable. The function <code><a href="../reference/createInputForDescriptives.html">createInputForDescriptives()</a></code>
creates a template to provide the information that is needed to
calculate the descriptive statistics for an <code>GADSdat</code> object.
The function has some arguments you can use to get a better result and
less manual editing in the next step.</p>
<div class="section level4">
<h4 id="input-for-descriptives-table">Input for Descriptives Table<a class="anchor" aria-label="anchor" href="#input-for-descriptives-table"></a>
</h4>
<p>Here you can see an example how the object should look like and what
the different columns mean.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inputForDescriptives</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createInputForDescriptives.html">createInputForDescriptives</a></span><span class="op">(</span>GADSdat <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in FUN(data[x, , drop = FALSE], ...): Identification of fake scales</span></span>
<span><span class="co">#&gt; cannot be done completely automatically. Please check if the assignment of</span></span>
<span><span class="co">#&gt; which items belong to a common scale is correct.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">inputForDescriptives</span><span class="op">)</span></span>
<span><span class="co">#&gt;              varName                                  varLabel format   imp</span></span>
<span><span class="co">#&gt; FALSE.1           ID                                      &lt;NA&gt;     A2 FALSE</span></span>
<span><span class="co">#&gt; FALSE.2        IDSCH                                      &lt;NA&gt;   F8.0 FALSE</span></span>
<span><span class="co">#&gt; FALSE.3  varMetrisch metrische Beispielvariable, Kompetenzwert   F8.2 FALSE</span></span>
<span><span class="co">#&gt; FALSE.4   varOrdinal ordinale Beispielvariable, Kompetenzstufe   F8.0 FALSE</span></span>
<span><span class="co">#&gt; FALSE.5       varCat                 nominale Beispielvariable     A1 FALSE</span></span>
<span><span class="co">#&gt; FALSE.6 skala1_item1                    Likert-Skalenindikator   F8.0 FALSE</span></span>
<span><span class="co">#&gt;             type   scale       group</span></span>
<span><span class="co">#&gt; FALSE.1 variable    &lt;NA&gt;          ID</span></span>
<span><span class="co">#&gt; FALSE.2 variable    &lt;NA&gt;       IDSCH</span></span>
<span><span class="co">#&gt; FALSE.3 variable numeric varMetrisch</span></span>
<span><span class="co">#&gt; FALSE.4 variable ordinal  varOrdinal</span></span>
<span><span class="co">#&gt; FALSE.5 variable    &lt;NA&gt;      varCat</span></span>
<span><span class="co">#&gt; FALSE.6     item ordinal      skala1</span></span></code></pre></div>
<p>You can look at the template data frame either in R or save it in a
new Excel file.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># look at it in R</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">inputForDescriptives</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># export in Excel</span></span>
<span><span class="fu"><a href="../reference/writeExcel.html">writeExcel</a></span><span class="op">(</span><span class="va">inputForDescriptives</span>, <span class="st">"file_path/inputForDescriptives.xlsx"</span><span class="op">)</span></span></code></pre></div>
<p>Some information may need to be modified because the function does
not label it correctly. For this, it is necessary to understand the
functionality and check the variable entries. We will come back to how
to actually edit the table in R.</p>
<blockquote>
<p>Here is a brief overview of the different columns in the
<code>inputForDescriptives</code> object:</p>
<ul>
<li>
<strong>varName</strong>: The name of the variable of the
GADS-object</li>
<li>
<strong>varLabel</strong>: The label of the variable of the
GADS-object</li>
<li>
<strong>format</strong>: The format of the variable of the
GADS-object, e.g. how to display the variable in the codebook</li>
<li>
<strong>imp</strong>: Indicator if imputed variables are
involved</li>
<li>
<strong>type</strong>: Indicator of whether it is a single variable,
a scale or a scale’s item</li>
<li>
<strong>scale</strong>: Indicator of how the variable is to be
represented, e.g. what kind of statistics are shown</li>
<li>
<strong>group</strong>: Possibility to group variables, e.g. to
group scales and their items.</li>
</ul>
</blockquote>
<p>In the <strong>varName</strong>, <strong>varLabel</strong> and
<strong>format</strong> columns are information about the variables of
the data set. You don’t have to edit anything.</p>
<p><strong>imp</strong> can be set to <em>WAHR</em> or <em>FALSCH</em>.
For imputed variables it needs to be set to <em>WAHR</em>. If there are
several variables to be displayed on one page they must also be assigned
to the same group at <strong>group</strong>.</p>
<p><strong>type</strong> can be set to <em>variable</em>,
<em>scale</em>, <em>item</em> or <em>fake_item</em>. If you have a scale
with several individual items, the scale variable is set to
<em>scale</em> and the individual items to <em>item</em>. If you have
several items belonging to one scale, but no scale variable, set the
type to <em>fake_item</em>. All other variables should always get
<em>variable</em> as an entry.<br>
Imputed variables (<code>imp = WAHR</code>) should always get the type
<em>variable</em> for now.</p>
<p>The <strong>scale</strong> column specifies how the variable is to be
displayed. If it is empty, no descriptives are displayed.
<em>nominal</em> variables display the frequency distribution of the
labeled categories. <em>ordinal</em> variables display the frequency
distribution of the labeled categories <em>and</em> the statistical
parameters (like <em>M</em> or <em>SD</em>). <em>numeric</em> variables
only display the statistical parameters, without labeled categories.</p>
<p>Now you can look at different possibilities how to represent
variables in the codebook and how the table must be edited for this.</p>
</div>
<div class="section level4">
<h4 id="variables-without-descriptives">Variables without Descriptives<a class="anchor" aria-label="anchor" href="#variables-without-descriptives"></a>
</h4>
<p>This can be the case, for example, with ID variables or character
variables. The page would be displayed like this:<br><br><img src="pictures/codebook_IDs.PNG" alt="codebook_IDs"><br><br><br>
The entry in Excel or the data frame must look like this:<br><br><img src="pictures/input_IDs.PNG" alt="input_IDs"><br><br></p>
</div>
<div class="section level4">
<h4 id="categorial-variables">Categorial Variables<a class="anchor" aria-label="anchor" href="#categorial-variables"></a>
</h4>
<p>Variables with <strong>nominal</strong> scales should display only
the frequency distribution of the labeled categories. The page would be
displayed like this:<br><br><img src="pictures/codebook_nominal.png" alt="codebook_nominal"><br><br></p>
<p>The example data set doesn’t have any nominal variables at the
moment. If your data set has nominal variables, you can create that page
with the following input:</p>
<p><br><img src="pictures/input_nominal.png" alt="input_nominal"><br><br></p>
</div>
<div class="section level4">
<h4 id="categorial-variables-and-statistical-parameters">Categorial Variables and Statistical Parameters<a class="anchor" aria-label="anchor" href="#categorial-variables-and-statistical-parameters"></a>
</h4>
<p>Variables with <strong>ordinal</strong> scales should display the
frequency distribution of the labeled categories as well as the
statistical parameters <em>N</em> (number of participants), <em>M</em>
(mean) and <em>SD</em> (standard deviation). The page would be displayed
like this:</p>
<p><br><img src="pictures/codebook_ordinal.PNG" alt="codebook_ordinal"><br><br></p>
<p>The entry in Excel or the data frame must look like this:<br><br><img src="pictures/input_ordinal.PNG" alt="input_ordinal"><br><br></p>
</div>
<div class="section level4">
<h4 id="numeric-variables-without-labeled-values">Numeric Variables without Labeled Values<a class="anchor" aria-label="anchor" href="#numeric-variables-without-labeled-values"></a>
</h4>
<p>Variables with <strong>numeric</strong> scales should display only
statistical parameters: <em>N</em> (number of participants), <em>M</em>
(mean), <em>SD</em> (standard deviation), <em>Min.</em> (lowest value)
and <em>Max.</em> (highest value). This can be used for variables that
represent age or variables with values in the decimal range.
Nevertheless, these variables can contain labels for values. If they are
defined as missing, these values are not taken into account in the
calculation but are still reported. The page would be displayed like
this:</p>
<p><br><img src="pictures/codebook_numeric.PNG" alt="codebook_numeric"><br><br></p>
<p>The entry in Excel or the data frame must look like this:<br><br><img src="pictures/input_numeric.PNG" alt="input_numeric"><br><br></p>
</div>
<div class="section level4">
<h4 id="scale-variables-with-individual-items">Scale Variables with Individual Items<a class="anchor" aria-label="anchor" href="#scale-variables-with-individual-items"></a>
</h4>
<p>It is possible to get the following entries in the codebook for a
<strong>scale</strong> and the <strong>items</strong> it is made of:</p>
<p><br><img src="pictures/codebook_scale1.PNG" alt="codebook_scale1"><img src="pictures/codebook_scale2.PNG" alt="codebook_scale2"><img src="pictures/codebook_scale3.PNG" alt="codebook_scale3"><br><br></p>
<p>To get these pages the individual items must be labeled as
<strong>ordinal</strong> and <strong>item</strong>, and the scale as
<strong>numeric</strong> and <strong>scale</strong>. They must all have
the same name at <strong>group</strong> so that they are displayed
together.<br><br><br><img src="pictures/input_scale.PNG" alt="input_scale_new"><br><br></p>
<p>This only works, when they are grouped and labeled correctly. Later
the function <code><a href="../reference/createScaleInfo.html">createScaleInfo()</a></code> creates a data frame with
all scales and their items that were grouped like this.</p>
</div>
<div class="section level4">
<h4 id="fake-scales">Fake Scales<a class="anchor" aria-label="anchor" href="#fake-scales"></a>
</h4>
<p>Sometimes several items make up a scale, but the data set doesn’t
have a matching scale variable. The codebook would display it like a
normal scale (see <em>Scale Variables with Individual Items</em>) with
the same descriptive statistics.</p>
<p>To display fake scales like a real one, you need to group them like a
real scale, but in the <strong>type</strong> column you need to write
<strong>fake_item</strong>, so it looks like this:</p>
<p><br><img src="pictures/input_fakeScale.png" alt="input_fakeScale"><br><br></p>
<p>The function <code><a href="../reference/createScaleInfo.html">createScaleInfo()</a></code> should add these fake
scales to the data frame as well. But without the scale variable the
information which variables belong to that scale might be lost. The
individual variables might need to be added manually. See <a href="#add-fake-scales">Scales</a> for more information.</p>
</div>
<div class="section level4">
<h4 id="imputation-variables">Imputation Variables<a class="anchor" aria-label="anchor" href="#imputation-variables"></a>
</h4>
<p>The BT sometimes uses imputations, for instance, in the student data
set (sus). It’s a way to deal with missing data on variables by
replacing missing values with substituted values, usually several times.
You can recognize the variables by the addition <code>(imputiert)</code>
in their label or <code>_pooled</code> in their group. These imputations
represent one (averaged) variable, so they should be displayed as one.
Depending on what was specified in <strong>scale</strong>, it results in
the following pages in the codebook. <code>pv_pooled</code> has
<em>numeric</em> input, <code>pvkat_pooled</code> has <em>ordinal</em>
input.</p>
<p><br><img src="pictures/codebook_imp1.PNG" alt="codebook_imp1"><img src="pictures/codebook_imp2.PNG" alt="codebook_imp2"><br><br></p>
<p>To display it like this the <strong>imp</strong> column becomes
relevant. It must be set to <strong>WAHR</strong> for these variables.
In addition, the variables also need a common name in
<strong>group</strong> and, depending on whether they are to be
represented categorically or numerically, the corresponding designation
in <strong>scale</strong>, the scale should match the original
variable.<br><br><img src="pictures/input_imp.PNG" alt="input_imp"><br><br></p>
<p>The function <code><a href="../reference/createScaleInfo.html">createScaleInfo()</a></code> adds an extra column for
imputed variables similar to a scale and their items to the data frame.
More on that later.</p>
</div>
</div>
<div class="section level3">
<h3 id="descriptives-statistics-to-do">Descriptives Statistics To-do<a class="anchor" aria-label="anchor" href="#descriptives-statistics-to-do"></a>
</h3>
<p>The editing of the descriptives can be a lot of code, especially if
you have several data sets, so it’s best to do this in a separate file.
Make sure the packages <code>eatCodebook</code> and <code>eatGADS</code>
are loaded.</p>
<p>After you imported the data sets, you open
<strong>1_kennwerte.R</strong>. Then you copy the
<code>Import Data</code> Code in this file, so you can work on it
without needing to open <strong>0_main.R</strong> the next time you work
on it.</p>
<p>For each imported data set, you create a new object with
<code><a href="../reference/createInputForDescriptives.html">createInputForDescriptives()</a></code> containing input for the
descriptive statistics about each variable like their <em>name</em>,
<em>label</em>, <em>format</em>, <em>scale level</em> or which variables
are <em>grouped</em> together. You edit them according to the <a href="#input-for-descriptives-table">About section</a>, check the input
and then you calculate the actual descriptive statistics with
<code><a href="../reference/calculateDescriptives.html">calculateDescriptives()</a></code>.</p>
<div class="section level4">
<h4 id="create-input-for-descriptives">Create <strong>Input for Descriptives</strong><a class="anchor" aria-label="anchor" href="#create-input-for-descriptives"></a>
</h4>
<p>You use the function <code><a href="../reference/createInputForDescriptives.html">createInputForDescriptives()</a></code> to
create a data frame for each data set separately and name them according
to your data sets like <code>descriptives_sus</code> or
<code>descriptives_lfb_allg</code>, etc. The function needs the
<code>GADSdat</code> data set (e.g. <code>data_sus</code>) and returns a
data frame.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># example dat from eatCodebook</span></span>
<span><span class="va">inputForDescriptives</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createInputForDescriptives.html">createInputForDescriptives</a></span><span class="op">(</span>GADSdat <span class="op">=</span> <span class="va">dat</span>, nCatsForOrdinal <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># BT example code</span></span>
<span><span class="va">descriptives_sus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createInputForDescriptives.html">createInputForDescriptives</a></span><span class="op">(</span>GADSdat <span class="op">=</span> <span class="va">data_sus</span>, nCatsForOrdinal <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">descriptives_lfb_allg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createInputForDescriptives.html">createInputForDescriptives</a></span><span class="op">(</span>GADSdat <span class="op">=</span> <span class="va">data_lfb_allg</span>, nCatsForOrdinal <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>You should save each data frame separately to Excel. When you work
with the template you don’t need to adjust the file path - the Excel
should be saved in the folder <code>excel_files</code>. You just need to
make sure, that you are in the right working directory. Otherwise you
would have to adjust the file path. Remember adjusting the file names
when you copy and paste the code for the other data sets.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/writeExcel.html">writeExcel</a></span><span class="op">(</span><span class="va">descriptives_sus</span>, <span class="st">".\\excel_files\\descriptives_sus.xlsx"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/writeExcel.html">writeExcel</a></span><span class="op">(</span><span class="va">descriptives_lfb_allg</span>, <span class="st">".\\excel_files\\descriptives_lfb_allg.xlsx"</span><span class="op">)</span></span></code></pre></div>
<p>Now you should have as many Excel files as you imported data
sets.</p>
</div>
<div class="section level4">
<h4 id="check-and-edit-inputfordescriptives">Check and Edit <code>inputForDescriptives</code><a class="anchor" aria-label="anchor" href="#check-and-edit-inputfordescriptives"></a>
</h4>
<p>After saving them as Excel files you need to import them again with
<code><a href="../reference/getInputForDescriptives.html">getInputForDescriptives()</a></code>. All <code>getX()</code>
functions check for proper format and run important cleaning
functions.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">descriptives_sus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getInputForDescriptives.html">getInputForDescriptives</a></span><span class="op">(</span><span class="st">".\\excel_files\\descriptives_sus.xlsx"</span><span class="op">)</span></span></code></pre></div>
<p>Then you can look at the descriptives either by opening Excel
manually or by opening them in RStudio with <code><a href="https://rdrr.io/r/utils/View.html" class="external-link">View()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># eatCodebook example</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">inputForDescriptives</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># BT example code</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">descriptives_sus</span><span class="op">)</span></span></code></pre></div>
<p>It should look somethings like this:</p>
<p><img src=".%5Cpictures%5CR_view(descriptives).png"></p>
<p>Now you have to check, whether everything is the way you need it to
be. If not, you have to either make changes in the Excel file manually
or directly in R. If you write a script that changes the data frame in
R, you can easily rerun it if you need to recreate the descriptives
later (which is often the case). After that you should save your changes
under <code>descriptives_sus_edited.xlsx</code>, so you don’t need to
recreate the original Excel later if needed.</p>
<div class="section level5">
<h5 id="edit-inputfordescriptives-in-r">Edit <code>inputForDescriptives</code> in R<a class="anchor" aria-label="anchor" href="#edit-inputfordescriptives-in-r"></a>
</h5>
<p>Here are some examples on how to edit the data frames using R. You
might not have to edit anything or add some more lines of code,
depending on the data that you’re given. <em>The examples to edit the
data frames use the example <code>dat</code> from
<code>eatCodebook</code></em>.</p>
<p>Sometimes <code>createInputForDescriptives</code> creates different
scale levels or type labels than we need. You can adjust each line
individually with <code>descriptives$scale</code> or
<code>descriptives$type</code> and the row number <code>[n]</code>. Or
you change multiple lines at the same time. Just like you would any
other data frame in R.</p>
<p>The column <strong>scale</strong> is later important for how the
variable is displayed in the finished codebook. Sometimes the function
sets the scale of variables to <code>nominal</code>, but they should
have <code>ordinal</code>, as they are a scale item. You can adjust that
by extracting all relevant variables, for instance by name, using
<code><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep()</a></code>, to identify the position of all variables that
start with a certain name in <code>descriptives_sus</code>. Sometimes
you need to recreate the descriptives objects/files and the position
might change, but the variable name should stay the same. In this case
you wouldn’t have to adjust your code and can just rerun it. With the
position of the variables, you can change multiple variables at the same
time. You can also change other columns this way.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extracting the position of variables skala1_item1 - skala1_item3</span></span>
<span><span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"skala1_"</span>, <span class="va">inputForDescriptives</span><span class="op">$</span><span class="va">varName</span><span class="op">)</span></span>
<span><span class="co"># adjusting the input for the column `scale`</span></span>
<span><span class="va">inputForDescriptives</span><span class="op">$</span><span class="va">scale</span><span class="op">[</span><span class="va">pos</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"ordinal"</span></span></code></pre></div>
<p>You can also adjust their <strong>group</strong> this way.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># adjusting the input for the column `group`</span></span>
<span><span class="va">inputForDescriptives</span><span class="op">$</span><span class="va">group</span><span class="op">[</span><span class="va">pos</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"skala1"</span></span></code></pre></div>
<p>Scales and their items should be labeled correctly in the column
<strong>type</strong>. The scale needs the label <code>scale</code>, the
items the label <code>item</code>; variables from a fake scale have no
sparate scale variable and all need the label
<code>fake_item</code>.</p>
<p>You can identify scale variables with the first line of code and save
it in the object <code>group</code>. The scale’s <code>varName</code> is
usually also the <code>group</code> label. The loop identifies all
variables with matching <code>group</code> labels that have the wrong
<code>type</code> label.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># identifying all scale variables</span></span>
<span><span class="va">group</span> <span class="op">&lt;-</span> <span class="va">inputForDescriptives</span><span class="op">[</span><span class="va">inputForDescriptives</span><span class="op">$</span><span class="va">type</span> <span class="op">==</span> <span class="st">"scale"</span>,<span class="op">]</span><span class="op">$</span><span class="va">group</span></span>
<span><span class="co"># adjusting the item variables</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">var</span> <span class="kw">in</span> <span class="va">group</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">inputForDescriptives</span><span class="op">[</span><span class="va">inputForDescriptives</span><span class="op">$</span><span class="va">group</span> <span class="op">==</span> <span class="va">var</span> <span class="op">&amp;</span> <span class="va">inputForDescriptives</span><span class="op">$</span><span class="va">type</span> <span class="op">==</span> <span class="st">"variable"</span>,<span class="op">]</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"item"</span> </span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="save-your-changes">Save your changes<a class="anchor" aria-label="anchor" href="#save-your-changes"></a>
</h4>
<p>When you made sure the variables are correctly labeled and grouped,
you save the new data frame in Excel. You can either overwrite the
existing Excel file, but I recommend saving it in a new
<code>_edited.xlsx</code> file for better comparison. You use the same
lines as before, just adjust the file name. Then import the new Excel
again to make sure the format is still right and load it into a new
object with the ending <code>_edited</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save changes</span></span>
<span><span class="fu"><a href="../reference/writeExcel.html">writeExcel</a></span><span class="op">(</span><span class="va">descriptives_sus</span>, <span class="st">".\\excel_files\\descriptives_sus_edited.xlsx"</span><span class="op">)</span></span>
<span><span class="co"># import changes</span></span>
<span><span class="va">descriptives_sus_edited</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getInputForDescriptives.html">getInputForDescriptives</a></span><span class="op">(</span><span class="st">".\\excel_files\\descriptives_sus_edited.xlsx"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="check-scale-consistency">Check Scale Consistency<a class="anchor" aria-label="anchor" href="#check-scale-consistency"></a>
</h4>
<p>You need to use <code><a href="../reference/checkScaleConsistency.html">checkScaleConsistency()</a></code> for all
<code>descriptives_x_edited</code> objects that have scales separately.
The function checks whether the grouping of variables that belong to the
same scale matches in both the data set itself and the created
descriptives file. Be mindful of warnings or errors, they might indicate
something that will cause problems later.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_scale</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkScaleConsistency.html">checkScaleConsistency</a></span><span class="op">(</span><span class="va">data_sus</span>, <span class="va">descriptives_sus_edited.xlsx</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">descriptives_sus_edited.xlsx</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="calculate-descriptives">Calculate Descriptives<a class="anchor" aria-label="anchor" href="#calculate-descriptives"></a>
</h4>
<p>After preparing and checking the <em>input for descriptives</em> you
now actually <strong>calculate the descriptives</strong>
(<code>kennwerte</code>) with <code><a href="../reference/calculateDescriptives.html">calculateDescriptives()</a></code> for
each data set separately. Depending on how large the data set is, this
can take a while.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kennwerte_sus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculateDescriptives.html">calculateDescriptives</a></span><span class="op">(</span>GADSdat <span class="op">=</span> <span class="va">data_sus</span>, inputForDescriptives <span class="op">=</span> <span class="va">descriptives_sus_edited</span>, showCallOnly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">kennwerte_lfb_allg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculateDescriptives.html">calculateDescriptives</a></span><span class="op">(</span>GADSdat <span class="op">=</span> <span class="va">data_lfb_allg</span>, inputForDescriptives <span class="op">=</span> <span class="va">descriptives_lfb_allg_edited</span>, showCallOnly <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="save-objects-in-two-lists">Save Objects in Two Lists<a class="anchor" aria-label="anchor" href="#save-objects-in-two-lists"></a>
</h4>
<p>After creating the <code>inputForDescriptives</code> and the
calculating the descriptives (<code>kennwerte</code>), you save all of
them in <strong>two lists</strong>, one for the <strong>input</strong>,
one for the <strong>kennwerte</strong>. The order should match the order
of <code>datalist</code>, the list of the raw data sets, the names
should also match the <code>datalist</code> names.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># inputForDescriptives list</span></span>
<span><span class="va">input_descriptives</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sus <span class="op">=</span> <span class="va">descriptives_sus_edited</span>,</span>
<span>                           lfb_allg <span class="op">=</span> <span class="va">descriptives_lfb_allg_edited</span>,</span>
<span>                           lfb_spez <span class="op">=</span> <span class="va">descriptives_lfb_spez_edited</span>,</span>
<span>                           slfb <span class="op">=</span> <span class="va">descriptives_slfb_edited</span>,</span>
<span>                           match <span class="op">=</span> <span class="va">descriptives_match_edited</span><span class="op">)</span></span>
<span><span class="co"># kennwerte list</span></span>
<span><span class="va">kennwerte</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sus <span class="op">=</span> <span class="va">kennwerte_sus</span>, lfb_allg <span class="op">=</span> <span class="va">kennwerte_lfb_allg</span>, lfb_spez <span class="op">=</span> <span class="va">kennwerte_lfb_spez</span>, slfb <span class="op">=</span> <span class="va">kennwerte_slfb</span>, match <span class="op">=</span> <span class="va">kennwerte_match</span><span class="op">)</span></span></code></pre></div>
<p>Then save them in two <code>.RDS</code> files with
<code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS()</a></code> in the folder <em>excel_files</em>. You can
import them again with <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS()</a></code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save files</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">input_descriptives</span>, <span class="st">".\\excel_files\\input_descriptives.RDS"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">kennwerte</span>, <span class="st">".\\excel_files\\kennwerte.RDS"</span><span class="op">)</span></span>
<span><span class="co"># load files</span></span>
<span><span class="va">input_descriptives</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">".\\excel_files\\input_descriptives.RDS"</span><span class="op">)</span></span>
<span><span class="va">kennwerte</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">".\\excel_files\\kennwerte.RDS"</span><span class="op">)</span></span></code></pre></div>
<p>You should add the last two lines (load files) in your
<strong>0_main.R</strong> script behind the data import (see
template).</p>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="value-and-missing-labels">3. Value and Missing Labels<a class="anchor" aria-label="anchor" href="#value-and-missing-labels"></a>
</h2>
<p>Next you create the documentation of the value labels of valid and
missing values that is created with the function
<code><a href="../reference/createMissings.html">createMissings()</a></code>.</p>
<div class="section level3">
<h3 id="about-missings">About Missings<a class="anchor" aria-label="anchor" href="#about-missings"></a>
</h3>
<p>You create an Excel file that contains information on missing tags
and labels used in the data sets.</p>
<div class="section level4">
<h4 id="example-table">Example Table<a class="anchor" aria-label="anchor" href="#example-table"></a>
</h4>
<p>Here you can see what the <code>missings</code> data frame should
look like.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">missings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createMissings.html">createMissings</a></span><span class="op">(</span><span class="va">dat</span>, inputForDescriptives <span class="op">=</span> <span class="va">inputForDescriptives</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">missings</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Var.name Wert missing       LabelSH Zeilenumbruch_vor_Wert</span></span>
<span><span class="co">#&gt; 3 varMetrisch  -99      ja   not reached                   nein</span></span>
<span><span class="co">#&gt; 4 varMetrisch  -98      ja      omission                   nein</span></span>
<span><span class="co">#&gt; 5  varOrdinal    1    nein sehr schlecht                   nein</span></span>
<span><span class="co">#&gt; 6  varOrdinal    2    nein      schlecht                   nein</span></span>
<span><span class="co">#&gt; 7  varOrdinal    3    nein           gut                   nein</span></span>
<span><span class="co">#&gt; 8  varOrdinal    4    nein      sehr gut                   nein</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="missings-to-do">Missings To-do<a class="anchor" aria-label="anchor" href="#missings-to-do"></a>
</h3>
<p>Open <strong>0_main.R</strong> again. The data sets
<code>datalist</code> need to be loaded in the work space, as well as
the two lists <code>input_descriptives</code> and
<code>kennwerte</code>.</p>
<p>You create a new data frame with <code><a href="../reference/createMissings.html">createMissings()</a></code> and
save it to Excel as <code>missings.xlsx</code>. You import it again with
<code>getMisings()</code> to check the format. Usually there’s no need
to edit anything.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create missings</span></span>
<span><span class="va">missings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createMissings.html">createMissings</a></span><span class="op">(</span><span class="va">datalist</span>, <span class="va">input_descriptives</span><span class="op">)</span></span>
<span><span class="co"># save to Excel</span></span>
<span><span class="fu"><a href="../reference/writeExcel.html">writeExcel</a></span><span class="op">(</span>df_list <span class="op">=</span> <span class="va">missings</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, filePath <span class="op">=</span> <span class="st">".\\excel_files\\missings.xlsx"</span><span class="op">)</span></span>
<span><span class="co"># import Excel file and check for right format</span></span>
<span><span class="va">missings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getMissings.html">getMissings</a></span><span class="op">(</span><span class="st">".\\excel_files\\missings.xlsx"</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="scales">4. Scales<a class="anchor" aria-label="anchor" href="#scales"></a>
</h2>
<p>In order to display scales correctly, you need an Excel file with an
overview over all the scales and their items. Imputed variables that are
to be displayed together are also listed in this file.</p>
<div class="section level3">
<h3 id="about-scales">About Scales<a class="anchor" aria-label="anchor" href="#about-scales"></a>
</h3>
<p>Scale variables contain information about their scale, e.g. the items
that make up the scale. Fake scales are made up of variables, but don’t
have a separate scale variable; you can still display them as scales,
see <a href="#fake-scales">Fake Scales</a> for more information.</p>
<div class="section level4">
<h4 id="example-table-1">Example Table<a class="anchor" aria-label="anchor" href="#example-table-1"></a>
</h4>
<p><code><a href="../reference/createScaleInfo.html">createScaleInfo()</a></code> creates a list of data frames, each
data set has its own data frame (or sheet after saving to Excel). This
is what the scale info should look like:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scaleInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createScaleInfo.html">createScaleInfo</a></span><span class="op">(</span><span class="va">inputForDescriptives</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">scaleInfo</span><span class="op">)</span></span>
<span><span class="co">#&gt;           varName Anzahl_valider_Werte</span></span>
<span><span class="co">#&gt; 1          skala1                    -</span></span>
<span><span class="co">#&gt; 2 skala_fake_item                    -</span></span>
<span><span class="co">#&gt; 3       pv_pooled                    -</span></span>
<span><span class="co">#&gt; 4    pvkat_pooled                    -</span></span>
<span><span class="co">#&gt;                                      Items_der_Skala</span></span>
<span><span class="co">#&gt; 1             skala1_item1,skala1_item2,skala1_item3</span></span>
<span><span class="co">#&gt; 2 skala_fake_item1,skala_fake_item2,skala_fake_item3</span></span>
<span><span class="co">#&gt; 3                                                   </span></span>
<span><span class="co">#&gt; 4                                                   </span></span>
<span><span class="co">#&gt;                              Imputationen</span></span>
<span><span class="co">#&gt; 1                                        </span></span>
<span><span class="co">#&gt; 2                                        </span></span>
<span><span class="co">#&gt; 3                pv_1,pv_2,pv_3,pv_4,pv_5</span></span>
<span><span class="co">#&gt; 4 pvkat_1,pvkat_2,pvkat_3,pvkat_4,pvkat_5</span></span></code></pre></div>
<p>In <strong>VarName</strong> you have the name of the scale variable
or the group name (they should be the same).
<strong>Items_der_Skala</strong> contains all items belonging to the
scale or which have the same group name as a scale variable.
<strong>Imputationen</strong> lists all imputed variables for each group
name.</p>
<p>The function <code><a href="../reference/createScaleInfo.html">createScaleInfo()</a></code> “finds” the scales by
looking for matching variable (varName) and group names. Fake scales
usually don’t have a variable where these two entries match, so they are
often not displayed in the data frame per default. You’d have to add
them in a script or manually.</p>
</div>
</div>
<div class="section level3">
<h3 id="scales-to-do">Scales To-do<a class="anchor" aria-label="anchor" href="#scales-to-do"></a>
</h3>
<p>Open <strong>0_main.R</strong> and scroll to or add
<code>scales</code>. You need to create one <code>skalen.xlsx</code>
Excel file, each data set has its own page. It contains the info which
variables are scales and which items belong to it, as well as which
imputed variables belong together. You just need the list
<code>input_descriptives</code> for that. Usually you don’t need to edit
this file, unless you work with fake scales.</p>
<div class="section level4">
<h4 id="create-scales">Create Scales<a class="anchor" aria-label="anchor" href="#create-scales"></a>
</h4>
<p>The function <code><a href="../reference/createScaleInfo.html">createScaleInfo()</a></code> reads the information
about scales out of the descriptives list, and creates a new list of
data frames.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">skalen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createScaleInfo.html">createScaleInfo</a></span><span class="op">(</span><span class="va">input_descriptives</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="check-scales">Check Scales<a class="anchor" aria-label="anchor" href="#check-scales"></a>
</h4>
<p>You need to look at the object to make sure all scales are displayed
correctly.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">skalen</span><span class="op">)</span></span></code></pre></div>
<p>All errors and mismatches occurring here can or should usually be
fixed in the <code>inputForDescriptives</code> files.</p>
</div>
<div class="section level4">
<h4 id="save-scales">Save Scales<a class="anchor" aria-label="anchor" href="#save-scales"></a>
</h4>
<p>Then save the data frame to Excel and import again with
<code><a href="../reference/getScaleInfo.html">getScaleInfo()</a></code> to check for errors and format.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save to Excel</span></span>
<span><span class="fu"><a href="../reference/writeExcel.html">writeExcel</a></span><span class="op">(</span>df_list <span class="op">=</span> <span class="va">skalen</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, filePath <span class="op">=</span> <span class="st">".\\excel_files\\skalen.xlsx"</span><span class="op">)</span></span>
<span><span class="co"># import to check</span></span>
<span><span class="va">skalen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getScaleInfo.html">getScaleInfo</a></span><span class="op">(</span><span class="st">".\\excel_files\\skalen.xlsx"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="add-fake-scales">Add Fake Scales<a class="anchor" aria-label="anchor" href="#add-fake-scales"></a>
</h4>
<p>In order to add missing fake scales to the data frame, you need to
identify the fake scales, add the group name in <code>varName</code> and
the fake items in <code>Items_des_Skala</code>. Be mindful of the data
set in which the fake scale occurs when you work with mulpitle data
sets, e.g. <em>sus</em> or <em>lfb_allg</em>. The last BTs never used
fake scales, in this case, you can ignore this.</p>
<p>You can identify fake scales in the descriptives files by their label
<code>fake_item</code> in the column <em>type</em>. You need you sort
them by group and add them to the <code>skalen</code> data frame.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fakeItems</span> <span class="op">&lt;-</span> <span class="va">inputForDescriptives</span><span class="op">[</span><span class="va">inputForDescriptives</span><span class="op">$</span><span class="va">type</span> <span class="op">==</span> <span class="st">"fake_item"</span>,<span class="op">]</span></span>
<span><span class="va">fakeItems</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">7</span><span class="op">)</span><span class="op">]</span> <span class="co"># look at the names and group</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>newScales <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">varName =</span> <span class="fu">c</span>(<span class="st">"group1"</span>, <span class="st">"group2"</span>), <span class="at">Anzahl_valider_Werte =</span> <span class="st">"-"</span>, <span class="at">Items_der_Skala =</span> <span class="fu">c</span>(<span class="st">"fake_itemA1,fake_itemA2,fake_itemA3"</span>, <span class="st">"fake_itemB1,fake_itemB2,fake_itemB3"</span>), Imputationen <span class="st">""</span>)</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="co"># add to data frame</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>skalen <span class="ot">&lt;-</span> <span class="fu">rbind</span>(skalen, newScales)</span></code></pre></div>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="abbreviation-list">5. Abbreviation List<a class="anchor" aria-label="anchor" href="#abbreviation-list"></a>
</h2>
<p>You can add information about acronyms and statistical formula to the
codebook’s appendix.</p>
<div class="section level3">
<h3 id="about-the-abbreviation-list">About the Abbreviation List<a class="anchor" aria-label="anchor" href="#about-the-abbreviation-list"></a>
</h3>
<p>The codebook’s intro and additional texts might have abbreviations
that need explaining. You need a list of two data frames (or Excel file
with two sheets) with the abbreviations and their explanations: the
first data frame is for <strong>Akronyme</strong> (acronyms), the second
for <strong>statistische Formelzeichen</strong> (statistical
formula).</p>
<p>You can usually copy the Excel <code>abbr_list.xlsx</code> or
<code>abkürzungen.xlsx</code> from last BTs and adjust them if needed or
you create you own file with <code><a href="../reference/createAbbrList.html">createAbbrList()</a></code>.</p>
<p>You don’t need this object for the minimal version of the codebook,
so you can skip this part or come back to it later.</p>
<div class="section level4">
<h4 id="example-tables">Example Tables<a class="anchor" aria-label="anchor" href="#example-tables"></a>
</h4>
<p><code><a href="../reference/createAbbrList.html">createAbbrList()</a></code> creates a list of two data frames
<strong>Akronyme</strong> (acronyms) and <strong>statistische
Formelzeichen</strong> (statistical formula) with two columns each. The
first should contain all abbreviations used in any text in the codebook
and their meaning. The second should contain all statistical formula
symbols and their meaning. It should look something like this:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">abbr_list</span><span class="op">)</span></span></code></pre></div>
<p><img src=".%5Cpictures%5Cabbr_list_R.png"></p>
<p>In Excel: First sheet <code>Akronyme</code>, second sheet
<code>statistische Formelzeichen</code></p>
<p><img src=".%5Cpictures%5Cabbr_list_akronym.png"></p>
<p><img src=".%5Cpictures%5Cabbr_list_statFormula.png"></p>
<blockquote>
<p>Be mindful to use LaTeX syntax when you want to display special
characters or italic letters, especially in the formula sheet!</p>
</blockquote>
</div>
</div>
<div class="section level3">
<h3 id="abbreviation-list-to-do">Abbreviation List To-do<a class="anchor" aria-label="anchor" href="#abbreviation-list-to-do"></a>
</h3>
<p>Open <strong>0_main.R</strong> and scroll to or add
<code>abbreviation list</code>. You create either an empty object for
the abbreviation list with <code><a href="../reference/createAbbrList.html">createAbbrList()</a></code> or read in the
one from last year’s BT, call it <code>abbr_list</code>, and save it in
a new Excel file.</p>
<div class="section level4">
<h4 id="create-new-empty-list">Create New Empty List<a class="anchor" aria-label="anchor" href="#create-new-empty-list"></a>
</h4>
<p>You create two empty data frames in a list with
<code><a href="../reference/createAbbrList.html">createAbbrList()</a></code>, already labeled correctly. You can edit
it in R or save it to Excel as <code>abkürzung.xlsx</code> in the folder
<em>excel_files</em> and edit it manually.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abbr_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createAbbrList.html">createAbbrList</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># save in Excel</span></span>
<span><span class="fu"><a href="../reference/writeExcel.html">writeExcel</a></span><span class="op">(</span>df_list <span class="op">=</span> <span class="va">abbr_list</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, filePath <span class="op">=</span> <span class="st">".\\excel_files\\abkürzung.xlsx"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="import-old-list">Import Old List<a class="anchor" aria-label="anchor" href="#import-old-list"></a>
</h4>
<p>You can also import an old <code>abkürzung.xlsx</code> from the last
BT. Save it to your work space and update it if necessary. You would
need to update your <code>file path</code> for that.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abbr_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getExcel.html">getExcel</a></span><span class="op">(</span><span class="st">"Q:\\filepath\\abkuerzung.xlsx"</span><span class="op">)</span></span>
<span><span class="co"># save in Excel</span></span>
<span><span class="fu"><a href="../reference/writeExcel.html">writeExcel</a></span><span class="op">(</span>df_list <span class="op">=</span> <span class="va">abbr_list</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, filePath <span class="op">=</span> <span class="st">".\\excel_files\\abkürzung.xlsx"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="update-the-list">Update the List<a class="anchor" aria-label="anchor" href="#update-the-list"></a>
</h4>
<p>You can add or delete entries in R like with any other data frame
that is saved in a list. After making changes, you need to save them to
Excel with <code><a href="../reference/writeExcel.html">writeExcel()</a></code>.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add a new line</span></span>
<span><span class="va">abbr_list</span><span class="op">$</span><span class="va">`Statistische Formelzeichen`</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">abbr_list</span><span class="op">$</span><span class="va">`Statistische Formelzeichen`</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>,<span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"α"</span>, <span class="st">"Cronbachs Alpha"</span><span class="op">)</span></span>
<span><span class="co"># add multiple lines</span></span>
<span><span class="va">newLines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Abkuerzung <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AG"</span>, <span class="st">"ALLG"</span><span class="op">)</span>, Bedeutung <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Arbeitsgemeinschaft"</span>, <span class="st">"Allgemeine Schule"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">abbr_list</span><span class="op">$</span><span class="va">Akronyme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">abbr_list</span><span class="op">$</span><span class="va">Akronyme</span>, <span class="va">newLines</span><span class="op">)</span></span>
<span><span class="co"># remove lines</span></span>
<span><span class="va">abbr_list</span><span class="op">$</span><span class="va">Akronyme</span> <span class="op">&lt;-</span> <span class="va">abbr_list</span><span class="op">$</span><span class="va">Akronyme</span><span class="op">[</span><span class="op">-</span><span class="fl">2</span>,<span class="op">]</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="notes-on-special-letters">Notes on Special Letters<a class="anchor" aria-label="anchor" href="#notes-on-special-letters"></a>
</h4>
<p>LaTeX can’t display Greek characters when you just use the letter by
itself. You might need to adjust the spelling. <code>$\alpha$</code> is
LaTeX code and should be printed like the image shows.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># edit one entry</span></span>
<span><span class="va">abbr_list</span><span class="op">$</span><span class="va">`Statistische Formelzeichen`</span><span class="op">$</span><span class="va">Symbol</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"$\alpha$"</span></span></code></pre></div>
<p><img src=".%5Cpictures%5Cabbr_list_alpha.png"></p>
<p>Italic letters or subscript/superscript also need special LaTeX code.
The code <code>$_{pw}$</code> makes the <em>pw</em> in subscript. Use
<code>$^{2}$</code> for supercript the 2 or <code>\textit{M}</code> to
print italic text or letters.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># new line with correct syntax</span></span>
<span><span class="va">abbr_list</span><span class="op">$</span><span class="va">`Statistische Formelzeichen`</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">abbr_list</span><span class="op">$</span><span class="va">`Statistische Formelzeichen`</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>,<span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"r$_{pw}$"</span>, <span class="st">"Part-whole-korrigierte Korrelation"</span><span class="op">)</span></span></code></pre></div>
<p>Either add new lines already with the LaTeX syntax or edit existing
entries.</p>
</div>
<div class="section level4">
<h4 id="use-makeabbrlist">Use <code>makeAbbrList()</code><a class="anchor" aria-label="anchor" href="#use-makeabbrlist"></a>
</h4>
<p>When the Excel file from past BTs has commentary/extra columns in it,
you can’t use the function <code><a href="../reference/makeAbbrList.html">makeAbbrList()</a></code>. Make sure you
only have two columns per sheet/data frame and delete any others, if
necessary.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># edit abbr_list</span></span>
<span><span class="va">abbr_list</span><span class="op">$</span><span class="va">Akronyme</span> <span class="op">&lt;-</span> <span class="va">abbr_list21</span><span class="op">$</span><span class="va">Akronyme</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">abbr_list</span><span class="op">$</span><span class="va">`Statistische Formelzeichen`</span> <span class="op">&lt;-</span> <span class="va">abbr_list21</span><span class="op">$</span><span class="va">`Statistische Formelzeichen`</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co"># save in Excel</span></span>
<span><span class="fu"><a href="../reference/writeExcel.html">writeExcel</a></span><span class="op">(</span>df_list <span class="op">=</span> <span class="va">abbr_list</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, filePath <span class="op">=</span> <span class="st">".\\excel_files\\abkürzung.xlsx"</span><span class="op">)</span></span></code></pre></div>
<p>When you have all the abbreviations, you can create the LaTeX code
that you need directly from the Excel file with
<code><a href="../reference/makeAbbrList.html">makeAbbrList()</a></code> and save it in <code>abbr_list</code>:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># creates LaTeX syntax</span></span>
<span><span class="va">abbr_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeAbbrList.html">makeAbbrList</a></span><span class="op">(</span><span class="st">".\\excel_files\\abkürzung.xlsx"</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="variable-information-varinfo">6. Variable Information (varinfo)<a class="anchor" aria-label="anchor" href="#variable-information-varinfo"></a>
</h2>
<p>Creating and editing the <code>varinfo</code> object is the
<strong>main work</strong> of creating the codebook. This object
contains all information about the variables, their order and structure,
as well as their references, instructions, remarks or information about
the background model. There is only one object or Excel file, but each
data set has its own sheet or data frame, so you can edit them
separately.</p>
<div class="section level3">
<h3 id="about-varinfo">About Varinfo<a class="anchor" aria-label="anchor" href="#about-varinfo"></a>
</h3>
<p>After preparing the <code>inputForDescriptives</code> you use the two
lists <code>datalist</code> (containing the data sets) and
<code>input_descriptives</code> to create a template list of data
frames, with one data frame per data set. Each data frame consists of a
column for the variables in the order of the
<code>inputForDescriptives_edited</code> file and several columns with
additional information about each variable.</p>
<p>In order for the variables to be displayed correctly in the codebook,
you need to add information on layout, structure, subsection names,
references, instructions, etc. for each variable. The order of the
variables in <code>varinfo</code> determines the order of the variables
in the codebook.</p>
<p>In the end, each data set will have it’s own chapter, each chapter
can have multiple sections with multiple subsections.
<code>varinfo</code> only contains information about the subsections.
Chapter and section information can be adjusted in a later step.</p>
<div class="section level4">
<h4 id="example-table-2">Example Table<a class="anchor" aria-label="anchor" href="#example-table-2"></a>
</h4>
<p>Here is in example what that can look like.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">varinfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createVarInfo.html">createVarInfo</a></span><span class="op">(</span><span class="va">dat</span>, inputForDescriptives <span class="op">=</span> <span class="va">inputForDescriptives</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">)</span></span>
<span><span class="co">#&gt;       Var.Name in.DS.und.SH Unterteilung.im.Skalenhandbuch Layout</span></span>
<span><span class="co">#&gt; 1           ID           ja                             NA      -</span></span>
<span><span class="co">#&gt; 2        IDSCH           ja                             NA      -</span></span>
<span><span class="co">#&gt; 3  varMetrisch           ja                             NA      -</span></span>
<span><span class="co">#&gt; 4   varOrdinal           ja                             NA      -</span></span>
<span><span class="co">#&gt; 5       varCat           ja                             NA      -</span></span>
<span><span class="co">#&gt; 6 skala1_item1           ds                             NA      -</span></span>
<span><span class="co">#&gt;                                     LabelSH Anmerkung.Var Gliederung</span></span>
<span><span class="co">#&gt; 1                                      &lt;NA&gt;             -          -</span></span>
<span><span class="co">#&gt; 2                                      &lt;NA&gt;             -          -</span></span>
<span><span class="co">#&gt; 3 metrische Beispielvariable, Kompetenzwert             -          -</span></span>
<span><span class="co">#&gt; 4 ordinale Beispielvariable, Kompetenzstufe             -          -</span></span>
<span><span class="co">#&gt; 5                 nominale Beispielvariable             -          -</span></span>
<span><span class="co">#&gt; 6                    Likert-Skalenindikator             -          -</span></span>
<span><span class="co">#&gt;   Reihenfolge                                     Titel rekodiert QuelleSH</span></span>
<span><span class="co">#&gt; 1          NA                                      &lt;NA&gt;      nein        -</span></span>
<span><span class="co">#&gt; 2          NA                                      &lt;NA&gt;      nein        -</span></span>
<span><span class="co">#&gt; 3          NA metrische Beispielvariable, Kompetenzwert      nein        -</span></span>
<span><span class="co">#&gt; 4          NA ordinale Beispielvariable, Kompetenzstufe      nein        -</span></span>
<span><span class="co">#&gt; 5          NA                 nominale Beispielvariable      nein        -</span></span>
<span><span class="co">#&gt; 6          NA                                         -      nein        -</span></span>
<span><span class="co">#&gt;   Instruktionen Hintergrundmodell HGM.Reihenfolge HGM.Variable.erstellt.aus</span></span>
<span><span class="co">#&gt; 1             -              nein               -                         -</span></span>
<span><span class="co">#&gt; 2             -              nein               -                         -</span></span>
<span><span class="co">#&gt; 3             -              nein               -                         -</span></span>
<span><span class="co">#&gt; 4             -              nein               -                         -</span></span>
<span><span class="co">#&gt; 5             -              nein               -                         -</span></span>
<span><span class="co">#&gt; 6             -              nein               -                         -</span></span>
<span><span class="co">#&gt;   intern.extern Seitenumbruch.im.Inhaltsverzeichnis</span></span>
<span><span class="co">#&gt; 1             -                                nein</span></span>
<span><span class="co">#&gt; 2             -                                nein</span></span>
<span><span class="co">#&gt; 3             -                                nein</span></span>
<span><span class="co">#&gt; 4             -                                nein</span></span>
<span><span class="co">#&gt; 5             -                                nein</span></span>
<span><span class="co">#&gt; 6             -                                nein</span></span></code></pre></div>
<p>Now we will look at the function of each column.</p>
<blockquote>
<p>Here is a brief overview of the different columns in
<em>varinfo</em>:</p>
<ul>
<li>
<strong>Var.Name</strong>: The name of the variable</li>
<li>
<strong>in.DS.und.SH</strong>: Indicator whether the variable is in
the codebook and data set</li>
<li>
<strong>Unterteilung.im.Skalenhandbuch</strong>: Overview of
subsection names</li>
<li>
<strong>Layout</strong>: Assignment of the layout options</li>
<li>
<strong>LabelSH</strong>: The label of the variable (has to match
the data set)</li>
<li>
<strong>Anmerkung.Var</strong>: Assignment of annotations in the
codebook</li>
<li>
<strong>Gliederung</strong>: Overview of section numbering</li>
<li>
<strong>Reihenfolge</strong>: Order of variables in the
codebook</li>
<li>
<strong>Titel</strong>: Title of the codebook page of the
variable</li>
<li>
<strong>rekodiert</strong>: Display whether a variable was
previously recoded</li>
<li>
<strong>QuelleSH</strong>: Specification of the sources of the
variable in a questionnaire</li>
<li>
<strong>Instruktionen</strong>: Specification of the instructions of
the variable in a questionnaire</li>
<li>
<strong>Hintergrundmodell</strong>: Indication of whether the
variable is in the background model</li>
<li>
<strong>HGM.Reihenfolge</strong>: The order for the background model
(in the appendix)</li>
<li>
<strong>HGM.Variable.erstellt.aus</strong>: Indication for the
background model from which variables the variable was created</li>
<li>
<strong>intern.extern</strong>: Indication of whether the variable
is for internal or external use</li>
<li>
<strong>Seitenumbruch.im.Inhaltsverzeichnis</strong>: Indication
whether there is a pagination in the table of contents for the
title</li>
</ul>
</blockquote>
<div class="section level5">
<h5 id="var-name">Var.Name<a class="anchor" aria-label="anchor" href="#var-name"></a>
</h5>
<p>Each variable name has to be <strong>unique</strong> across data
sets. You can’t have a variable in data set 2 called <code>IDBL</code>
if there’s an <code>IDBL</code> in data set 1 already.</p>
<blockquote>
<p>Across data sets, variables can’t have the same name!</p>
</blockquote>
</div>
<div class="section level5">
<h5 id="in-ds-und-sh">in.DS.und.SH<a class="anchor" aria-label="anchor" href="#in-ds-und-sh"></a>
</h5>
<p><code>DS</code> means <em>data set</em>, <code>SH</code>
<em>Skalenhandbuch</em> (codebook). Possible entries are
<code>DS</code>, <code>SH</code>, <code>ja</code> and
<code>nein</code>.</p>
<p>The <strong>in.DS.und.SH</strong> column indicates whether a variable
only appears in the data set but does not get its own page
(<em>ds</em>), whether it appears both in the codebook and in the data
set (<em>ja</em>), whether it only appears in the codebook (<em>sh</em>)
or neither (<em>nein</em>).</p>
<blockquote>
<p>When to assign what label:</p>
<ul>
<li>
<strong>ds</strong>: for example, for the items of the <strong>scale
variables</strong>, as they do not receive their own page</li>
<li>
<strong>sh</strong>: for <strong>pooled variables</strong>, as they
are shown in the codebook but do not exist in the actual data set</li>
<li>
<strong>nein</strong>: for variables that are added independently;
This can be the case, if you want to include them in the BGM
information, but the variables do not exist in the data set</li>
<li>
<strong>ja</strong>: all other variables or scale items</li>
</ul>
</blockquote>
<p>When everything is labeled correctly in the
<code>inputForDescriptives</code> files, the right labels should be
assigned. But you might need to adjust them.</p>
</div>
<div class="section level5">
<h5 id="unterteilung-im-skalenhandbuch-and-gliederung">Unterteilung.im.Skalenhandbuch and Gliederung<a class="anchor" aria-label="anchor" href="#unterteilung-im-skalenhandbuch-and-gliederung"></a>
</h5>
<p>The <strong>Unterteilung.im.Skalenhandbuch</strong> (subsection names
in the codebook) column gives the name for the subsections.</p>
<p>In the <strong>Gliederung</strong> (subsection numbers) column, the
subsection numbers must be inserted. Subsections such as “1.1”, “1.2”,…
“2.1”. The names of the corresponding sections are edited in a later
step (s. <a href="#structure">7. Structure</a>). Make sure the
subsections names and numbers match. You need to add the
<code>Gliederung</code> as well as the
<code>Unterteilung.im.Skalenhandbuch</code> from another (Excel) file,
for the BT codebook it’s usually called something like
<code>finale Reihenfolge.xlsx</code>. See <a href="#add-structure-and-subsections">To-do</a> on how to do that.</p>
<p>You can’t have duplicated subsection names. The sections
<em>Unterricht in Mathematik</em> and <em>Unterricht in Deutsch</em>
can’t both have a subsection called <em>Selbstkonzept</em> - it should
say something like <em>Selbstkonzept Mathematik</em> and
<em>Selbstkonzept Deutsch</em>.</p>
<blockquote>
<p>Across data sets, subsections or sections can’t have the same
name!</p>
</blockquote>
</div>
<div class="section level5">
<h5 id="layout">Layout<a class="anchor" aria-label="anchor" href="#layout"></a>
</h5>
<p>The input for the <strong>Layout</strong> column is automatically
created after using <code><a href="../reference/inferLayout.html">inferLayout()</a></code>.</p>
</div>
<div class="section level5">
<h5 id="labelsh-and-titel">LabelSH and Titel<a class="anchor" aria-label="anchor" href="#labelsh-and-titel"></a>
</h5>
<p>The <strong>Titel</strong> column specifies the title for the page
and defaults to the variable label. <code>LabelSH</code> has to be
identical to the label in the data set, usually without special
characters or umlauts. The spelling of <code>Titel</code> can be
adjusted and umlauts are OK.</p>
<p>If you have access to an Excel file with all variables and their
labels and titles, you can copy that into <code>varinfo</code> without
having to check the spelling for each variable’s title. The BT Team
might add the titles to the Excel containing the final order (finale
Reihenfolge).</p>
</div>
<div class="section level5">
<h5 id="anmerkung-var">Anmerkung.Var<a class="anchor" aria-label="anchor" href="#anmerkung-var"></a>
</h5>
<p>In this column, comments can be inserted (special text highlighting
or breaks must be in the LaTeX syntax), which are displayed as
annotations on the respective codebook page.</p>
</div>
<div class="section level5">
<h5 id="reihenfolge">Reihenfolge<a class="anchor" aria-label="anchor" href="#reihenfolge"></a>
</h5>
<p>In the <strong>Reihenfolge</strong> (order) column, the order of the
variables for the codebook can be specified. However, the order of the
subsections already determines the order of the variables. If the column
is left empty (or with a <code>0</code>), the order in
<code>varinfo</code> corresponds to the order in the codebook.</p>
<p>For the BT codebook, this column is usually left empty or set to
<code>0</code>.</p>
</div>
<div class="section level5">
<h5 id="rekodiert">rekodiert<a class="anchor" aria-label="anchor" href="#rekodiert"></a>
</h5>
<p>If a variable has been <strong>recoded</strong> in the course of
previous editing, this can be marked with a <code>ja</code> in the
<code>rekodiert</code> column and the variable gets a corresponding note
in the codebook as inverted if it is an item of a scale.</p>
<p>You recognize these variables by the addition <code>_r</code> in
<code>Var.Name</code>.</p>
</div>
<div class="section level5">
<h5 id="quellesh-and-instruktionen">QuelleSH and Instruktionen<a class="anchor" aria-label="anchor" href="#quellesh-and-instruktionen"></a>
</h5>
<p>In <strong>QuelleSH</strong> (references), the in-text citations can
be added. Based on this, there is a later function that creates the
reference list which contains all references and their matching in-text
citation. All references or in-text citations should be in <a href="https://apastyle.apa.org/style-grammar-guidelines/references/examples" class="external-link">APA</a>
format.</p>
<p>In the <strong>Instruktionen</strong> (instructions) column, you can
use text with LaTeX code for special characters to indicate which
instruction was used to collect the variable in a questionnaire.</p>
<p>Each variable can have one or multiple references and/or
instructions, some have neither. The BT team usually has Excel files for
each data set on <code>Q:</code> that matches references to the
variables.</p>
</div>
<div class="section level5">
<h5 id="background-model-hgm">Background Model (HGM)<a class="anchor" aria-label="anchor" href="#background-model-hgm"></a>
</h5>
<p>With <code>eatCodebook</code> you can also create a page in the
appendix for a background model (BGM) or <em>Hintergrundmodell</em>
(HGM) in German.</p>
<p>You need a BGM when you work with imputations as a statistical tool.
You don’t need to understand the details of a BGM when you create the
codebook. You just need to know that due to methodological reasons,
there are additional variables created that are not in the actual data
sets, that shouldn’t be displayed in the main codebook, but only in the
BGM appendix. For that, you need to add them to the respective
<code>varinfo</code> data frame. You can see how and where to add them
in the <a href="#add-background-model-info">To-do part</a>.</p>
<p>The appendix should look like this: <code>Hintergrundvariable</code>
contains the variable, <code>Erstellt aus</code> the variable(s) the
(new) variable was created from (if any), and
<code>Inhalt der Hintergrundvariable</code> contains the variable’s
label, e.g. the content of the background variable.</p>
<p><img src="pictures/BGM.PNG" alt="BGM"></p>
<p>There are three columns in <code>varinfo</code> that you need to edit
for variables to show up in the appendix.</p>
<blockquote>
<ul>
<li>
<strong>Hintergrundmodell</strong>: Indication of whether the
variable is in the background model.</li>
<li>
<strong>HGM.Reihenfolge</strong>: The order for the background model
(in the appendix)</li>
<li>
<strong>HGM.Variable.erstellt.aus</strong>: Indication for the
background model from which variables the variable was created</li>
</ul>
</blockquote>
<p>There should be another Excel file containing information on the
background model, also on <code>Q:</code>. It should contain the
variables that should show up in the appendix
(<code>Variablenname</code>), their labels (<code>Variablenlabel</code>)
and from which variables they were created from
(<code>basevar</code>).</p>
<p>For the variable to appear in the appendix, the column
<code>Hintergrundmodell</code> must be set to <em>ja</em>. Otherwise,
there must be a <em>nein</em>. Then you add the variables they were
created from (if any) listed in <code>basevar</code>. The order of the
variables should either match the one in the codebook or they should be
sorted in a way that makes sense. See last year’s BT codebook or ask the
responsible person from the BT team about the preferred order.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="varinfo-to-do">Varinfo To-do<a class="anchor" aria-label="anchor" href="#varinfo-to-do"></a>
</h3>
<p>Now comes the most time consuming part of actually creating and
editing the <code>varinfo</code>.</p>
<p>You have to create a list of data frames (one for each data set) and
save it to Excel. There’s a lot to add. While working on the
<code>varinfo</code> you often need to recreate it multiple times, so I
recommend writing a script in the additional file
<strong>2_varinfo.R</strong> to do the editing. Then you can just rerun
it without having to do too much. You should check after each
recreation, whether the script still worked correctly, though.</p>
<p>When working on the BT codebook for IQB, you can find most Excel
files containing the additional information to add on the network server
<code>Q:</code>.</p>
<p>When you open <strong>2_varinfo.R</strong> you will have to import
the data and the descriptives in order to create <code>varinfo</code>.
After the setup you need to add the following information. The order in
which you add them is up to you, but it makes sense to keep to the order
in this vignette.</p>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>Column in Varinfo</th>
<th>Where to get the Information from</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>
<code>QuelleSH</code> and <code>Instruktionen</code>
</td>
<td>Both usually in the same file under
<code>Q:/filepath/04_Instruktionen_Quellen</code>, one Excel file per
data set</td>
</tr>
<tr class="even">
<td>
<code>Gliederung</code> and
<code>Unterteilung.im.Skalenhandbuch</code>
</td>
<td>Often in one file called something like
<code>Reihenfolge_Variable_final.xlsx</code>, contains one sheet per
data set</td>
</tr>
<tr class="odd">
<td><code>rekodiert</code></td>
<td>Info in the <code>Var.Name</code>: all with <code>_r</code> at the
end</td>
</tr>
<tr class="even">
<td>
<code>Hintergrundmodell</code>, <code>HGM.Reihenfolge</code> and
<code>HGM.Variable.erstellt.aus</code>
</td>
<td>In an extra Excel file, you might have to ask about it or also on
<code>Q:</code>
</td>
</tr>
<tr class="odd">
<td>optional: <code>Anmerkung.Var</code>
</td>
<td>In a file on <code>Q:</code>
</td>
</tr>
</tbody>
</table>
<p>The order of the variables when you first create <code>varinfo</code>
depends on the order from the data sets. However, the final order of the
variables might be different. It’s best to match the input to each
variable by name to make sure the matching is correct.</p>
<p>In the end, you need to make sure that the order of
<code>varinfo</code> matches the one in the
<code>finale Reihenfolge</code> (final order) Excel.</p>
<p>I recommend starting with the files that have the same order as the
original <code>varinfo</code>, so you only have to change the variable
order once. For this vignette I’ll just describe the procedure for one
data set, but you need to do it for each data set,
e.g. <code>varinfo</code> data frame or Excel sheet.</p>
<p>After you created and edited the <code>varinfo.xlsx</code>, you need
to add this line to your <strong>0_main.R</strong> file.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">varinfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getVarInfo.html">getVarInfo</a></span><span class="op">(</span><span class="st">".\\excel_files\\varinfo_edited.xlsx"</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="varinfo-setup">Varinfo Setup<a class="anchor" aria-label="anchor" href="#varinfo-setup"></a>
</h4>
<p>Open <strong>2_varinfo.R</strong>. Make sure that all packages
(<code>eatCodebook</code>, <code>eatGADS</code>, <code>eatTools</code>),
<code>datalist</code> (the data sets), as well as
<code>input_descriptves</code> and <code>kennwerte</code> are loaded.
You can copy the code from <code>0_main.R</code> to the setup section of
this new file.</p>
<div class="section level5">
<h5 id="create-varinfo">Create Varinfo<a class="anchor" aria-label="anchor" href="#create-varinfo"></a>
</h5>
<p>You first create a <code>varinfo</code> object with
<code><a href="../reference/createVarInfo.html">createVarInfo()</a></code> from the SPSS data list you read in at the
beginning (<code>datalist</code>) and from the input for descriptives
list you created out of that (<code>input_descriptives</code>):</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">varinfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createVarInfo.html">createVarInfo</a></span><span class="op">(</span><span class="va">datalist</span>, <span class="va">input_descriptives</span><span class="op">)</span></span></code></pre></div>
<p>If you have multiple data sets stored in <code>datalist</code>, the
object <code>varinfo</code> will also be a list with several data
frames. Each data frame contains all variables from a data set and
columns that you need, but you still need to add a lot of information
from other files. It’s important that the data sets and descriptives
were named the same (<code>sus</code>, <code>lfb_allg</code>, etc.),
because <code><a href="../reference/createVarInfo.html">createVarInfo()</a></code> takes those names to name the
different data frames. You can look at <code>varinfo</code> as a list or
at each data frame separately:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View varinfo list object</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">)</span></span>
<span><span class="co"># View data frames in varinfo</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">$</span><span class="va">lfb_allg</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">$</span><span class="va">lfb_spez</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">$</span><span class="va">slfb</span><span class="op">)</span></span></code></pre></div>
<p>This is what the list of data frames <code>varinfo</code> can look
like:</p>
<p><img src="pictures%5Cvarinfo_object.png"></p>
<p>You can either save it directly as an Excel file or do the layout
first.</p>
</div>
<div class="section level5">
<h5 id="infer-layout">Infer Layout<a class="anchor" aria-label="anchor" href="#infer-layout"></a>
</h5>
<p>You add layout information for each variable with
<code><a href="../reference/inferLayout.html">inferLayout()</a></code>. You need the newly created
<code>varinfo</code> object, the <code>datalist</code> and
<code>input_descriptives</code>.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">varinfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inferLayout.html">inferLayout</a></span><span class="op">(</span><span class="va">varinfo</span>, <span class="va">datalist</span>, <span class="va">input_descriptives</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="save-to-excel">Save to Excel<a class="anchor" aria-label="anchor" href="#save-to-excel"></a>
</h5>
<p>Now save to Excel <code>varinfo.xlsx</code> as a template, and
<code>varinfo_edited.xlsx</code> as the file you actually work with in
the folder <em>excel_files</em>. Then you import and check the format of
<code>varinfo_edited.xlsx</code> by using <code><a href="../reference/getVarInfo.html">getVarInfo()</a></code>.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save to Excel</span></span>
<span><span class="fu"><a href="../reference/writeExcel.html">writeExcel</a></span><span class="op">(</span>df_list <span class="op">=</span> <span class="va">varinfo</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, filePath <span class="op">=</span> <span class="st">".\\excel_files\\varinfo.xlsx"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/writeExcel.html">writeExcel</a></span><span class="op">(</span>df_list <span class="op">=</span> <span class="va">varinfo</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, filePath <span class="op">=</span> <span class="st">".\\excel_files\\varinfo_edited.xlsx"</span><span class="op">)</span></span>
<span><span class="co"># import and check format</span></span>
<span><span class="va">varinfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getVarInfo.html">getVarInfo</a></span><span class="op">(</span><span class="st">".\\excel_files\\varinfo_edited.xlsx"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="add-references-and-instructions">Add References and Instructions<a class="anchor" aria-label="anchor" href="#add-references-and-instructions"></a>
</h4>
<p>To add the references and instructions you need access to the the
Excel files with all the variables listed plus their matching APA
in-text citations (like <code>Hertel et al. (2014)</code>) and their
instructions (in the questionnaire). The Excel should have two sheets,
one with at least 4 columns (Variable, Label, Instruktion and Quelle),
and a second one with the APA references and their in-text citations
that we need later. You need to do the following steps:</p>
<blockquote>
<ul>
<li>import the in-text citations and instructions, select proper sheet
(usually Sheet 1)</li>
<li>check the columns with <code><a href="https://rdrr.io/r/utils/View.html" class="external-link">View()</a></code>: <code>Variable</code>,
<code>Quelle</code> and <code>Instruktionen</code>
</li>
<li>match the in-text citations and instructions to the order of
<code>varinfo</code>
</li>
<li>transfer the entries, check your progress/proper matching and save
in between.</li>
</ul>
</blockquote>
<p>The matching data set is usually created due to technical reasons and
usually doesn’t have references or instructions, so you don’t need to
add anything to it</p>
<div class="section level5">
<h5 id="import-in-text-citations-and-instructions-from-excel">Import In-Text Citations and Instructions from Excel<a class="anchor" aria-label="anchor" href="#import-in-text-citations-and-instructions-from-excel"></a>
</h5>
<p>Import the Excel file with <code><a href="../reference/getExcel.html">getExcel()</a></code>, you need to add
the proper file path. Then select the right sheet, usually
<code>sheet 1</code>, and look at the data frame.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">quellen_sus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getExcel.html">getExcel</a></span><span class="op">(</span><span class="st">"filepath\\Instruktionen_Quellen.xlsx"</span><span class="op">)</span></span>
<span><span class="va">quellen_sus</span> <span class="op">&lt;-</span> <span class="va">quellen_sus</span><span class="op">$</span><span class="va">`Sheet 1`</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">quellen_sus</span><span class="op">)</span></span></code></pre></div>
<p>The data frame should look something like this.</p>
<p><img src="pictures%5Cvarinfo_quellen.png" style="width:100.0%"></p>
</div>
<div class="section level5">
<h5 id="check-variables">Check Variables<a class="anchor" aria-label="anchor" href="#check-variables"></a>
</h5>
<p>First, we should check, whether the two data frames
<code>varinfo$sus</code> and <code>quellen_sus</code> contain the same
variables with <code><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff()</a></code>. When the output is
<code>character(0)</code> for both lines the names match. The first line
might return a variable name that’s in <code>varinfo$sus</code>, but not
in <code>quellen_sus</code>, the second line the other way around. In
either case you probably have to clean up the data frames first, before
doing the next steps.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">$</span><span class="va">Var.Name</span>, <span class="va">quellen_sus</span><span class="op">$</span><span class="va">Variable</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">quellen_sus</span><span class="op">$</span><span class="va">Variable</span>, <span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">$</span><span class="va">Var.Name</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="clean-up-data">Clean Up Data<a class="anchor" aria-label="anchor" href="#clean-up-data"></a>
</h5>
<p>Before you clean up any data, it’s best to ask your supervisor or the
BT team on how to deal with these mismatches. In the following you will
see a few possible reasons and how you can deal with them.</p>
<p>The <strong>first line</strong> of <code><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff()</a></code>
<em><code>setdiff(varinfo$sus$Var.Name, quellen_sus$Variable)</code></em>
returns variables in <code>varinfo$sus</code> that are <em>not</em> in
<code>quellen_sus</code>. These variables often were created due to
technical or <strong>methodological reasons</strong> and usually have no
references or instructions. You can ignore them at this point.</p>
<p>The <strong>second line</strong> of <code><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff()</a></code>
<em><code>setdiff(quellen_sus$Variable, varinfo$sus$Var.Name)</code></em>
returns variables in <code>quellen_sus</code> that are <em>not</em> in
<code>varinfo$sus</code>. That is the case when 1) variables changed
<strong>spelling</strong> for some reason or 2) the variables are not
supposed to be in this data frame, for instance, because they’re already
in another one (this might be the case for <strong>identifier
variables</strong>).</p>
<p>For 1) you adapt the <strong>spelling</strong> to match the spelling
in <code>varinfo</code>. If this is the case, the first line usually
also returns a variable with similar spelling. In the BT21 there is a
variable called <code>Fach</code> in the <code>lfb_spez</code> data set,
which was called <code>LFACH</code> in the <code>quellen</code> Excel.
You can just rename it by identifying where it is and adjusting the
spelling. This is a case where it might be easier to update the
references Excel file, but you could also do this in your script:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">quellen_lfb_spez</span><span class="op">$</span><span class="va">Variable</span><span class="op">[</span><span class="va">quellen_lfb_spez</span><span class="op">$</span><span class="va">Variable</span> <span class="op">==</span> <span class="st">"LFACH"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Fach"</span></span></code></pre></div>
<p>For 2) you might have to <strong>remove the rows</strong> of the
references data frame, so you can transfer them later more easily. For
that you can save the respective variables from <code><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff()</a></code>
in a character vector and run the loop below that identifies their entry
in <code>quellen_sus</code> and removes them. For the BT21 three
variables had to be removed, if there’s only one that needs to be
removed, you can skip the the loop. Again it might be easier to adjust
the Excel file on <code>Q:</code>, but only after you asked about
that.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># identify position of variable "IDBL"</span></span>
<span><span class="va">mismatch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IDSCH"</span>, <span class="st">"IDBL"</span>, <span class="st">"LVERSION"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">var</span> <span class="kw">in</span> <span class="va">mismatch</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># identify position of the variables in `mismatch` </span></span>
<span>  <span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="va">var</span>, <span class="va">quellen_lfb_spez</span><span class="op">$</span><span class="va">Variable</span><span class="op">)</span></span>
<span>  <span class="co"># remove line</span></span>
<span>  <span class="va">quellen_lfb_spez</span> <span class="op">&lt;-</span> <span class="va">quellen_lfb_spez</span><span class="op">[</span><span class="op">-</span><span class="va">pos</span>,<span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>After that you check again for mismatches between the data frames.
When there are none (<code>character(0)</code>), you can go to the next
step. Output from the first line can still be ignored.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">$</span><span class="va">Var.Name</span>, <span class="va">quellen_sus</span><span class="op">$</span><span class="va">Variable</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">quellen_sus</span><span class="op">$</span><span class="va">Variable</span>, <span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">$</span><span class="va">Var.Name</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="check-matching-variables">Check Matching Variables<a class="anchor" aria-label="anchor" href="#check-matching-variables"></a>
</h5>
<p>Not every variable will have a reference or instruction, some of them
have the input <code>NA</code>, so in theory you could copy paste the
columns to <code>varinfo</code>. However, the order of the variables
between <code>varinfo</code> and the reference/instruction sheet might
be different. To check the order you need the function
<code><a href="https://rdrr.io/r/base/match.html" class="external-link">match()</a></code> which compares two character vectors - for instance
<code>quellen_sus$Variable</code> and <code>varinfo$sus$Var.Name</code>
which both contain the variable’s names.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">quellen_sus</span><span class="op">$</span><span class="va">Variable</span>, <span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">$</span><span class="va">Var.Name</span><span class="op">)</span></span>
<span><span class="va">pos</span></span></code></pre></div>
<p>It returns a numerical vector that contains the strings (here the
names) of the second vector (<code>varinfo$sus$Var.Name</code>) in the
order in which they appear in the first vector
(<code>quellen_sus$Variable</code>). Strings in the second vector
(<code>varinfo</code>) that don’t appear in the first
(<code>quellen_sus</code>) just won’t show up, so any extra variables in
<code>varinfo</code> will be ignored by this function. If there’s a
string in the first vector (<code>quellen_sus</code>) that isn’t in the
second (<code>varinfo</code>), the output will be <code>NA</code> - that
shouldn’t be the case, if you cleaned up the data properly.</p>
</div>
<div class="section level5">
<h5 id="transfer-in-text-citations-and-instructions">Transfer In-Text Citations and Instructions<a class="anchor" aria-label="anchor" href="#transfer-in-text-citations-and-instructions"></a>
</h5>
<p>After making sure you have the right variables in your
<code>quellen</code> object, you transfer the in-text citations and
instructions from into <code>varinfo</code>. In <code>pos</code> you
should now have the variable’s order (as a numeric vector) of the
variable names from <code>varinfo$sus</code> as they appear in
<code>quellen_sus</code>. So when you write these two lines to your
console, the in-text citations and instructions should be matched to the
proper variable in <code>varinfo</code>.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">$</span><span class="va">QuelleSH</span><span class="op">[</span><span class="va">pos</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">quellen_sus</span><span class="op">$</span><span class="va">Quelle</span></span>
<span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">$</span><span class="va">Instruktionen</span><span class="op">[</span><span class="va">pos</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">quellen_sus</span><span class="op">$</span><span class="va">Instruktion</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="check-new-input">Check New Input<a class="anchor" aria-label="anchor" href="#check-new-input"></a>
</h5>
<p>It’s best to compare the two data frames once more to make sure the
in-text citations and instructions are matched correctly. You can check
all variables with <code><a href="https://rdrr.io/r/utils/View.html" class="external-link">View()</a></code> or a random set of variables and
look at the respective columns.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compares variables 1 to 10:</span></span>
<span><span class="va">quellen_sus</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">11</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="save-progress">Save Progress<a class="anchor" aria-label="anchor" href="#save-progress"></a>
</h5>
<p>When everything matched correctly, save your progress and import the
Excel with <code><a href="../reference/getVarInfo.html">getVarInfo()</a></code> to check for format errors.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/writeExcel.html">writeExcel</a></span><span class="op">(</span>df_list <span class="op">=</span> <span class="va">varinfo</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, filePath <span class="op">=</span> <span class="st">".\\07_SH_Erstellung\\varinfo_edited.xlsx"</span><span class="op">)</span></span>
<span><span class="va">varinfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getVarInfo.html">getVarInfo</a></span><span class="op">(</span><span class="st">".\\07_SH_Erstellung\\varinfo_edited.xlsx"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="add-structure-and-subsections">Add Structure and Subsections<a class="anchor" aria-label="anchor" href="#add-structure-and-subsections"></a>
</h4>
<p>For the BT, you can usually find the info on the <em>Gliederung</em>
(subsection numbers) and <em>Unterteilung im Skalenhandbuch</em>
(subsection names) in an Excel called something like
<code>finale Reihenfolge</code> on <code>Q:</code>. It contains the
variable names, their labels and subsection info (number and name), as
well as adjusted titles (if needed). Each of the data sets have their
own sheet, except matching data which still needs subsection info for
technical reasons (see <a href="#linking-and-matching-data">here</a>).</p>
<p>This Excel file also contains the <strong>final order</strong> in
which the variables should be displayed in the codebook, so you need to
adjust the order in <code>varinfo</code> to match the one in
<code>finale Reihenfolge</code> (final order). You need to do the
following steps that are explained in more detail below:</p>
<blockquote>
<ul>
<li>Import the <code>finale Reihenfolge</code> file, select proper sheet
for your data set</li>
<li>Delete unnecessary rows (sections labeled as <code>NA</code>)</li>
<li>Compare variables (<code>varinfo</code> vs. final order)</li>
<li>Separate subsection names and numbers</li>
<li>Check for duplicate subsection names</li>
<li>Add missing subsections</li>
<li>Change order of <code>varinfo</code> to match the final order</li>
<li>Transfer subsection info in <code>varinfo</code>
</li>
<li>Update titles if necessary</li>
</ul>
</blockquote>
<blockquote>
<p>Each subsection name has to be unique.</p>
</blockquote>
<div class="section level5">
<h5 id="import-finale-reihenfolge">Import <code>finale Reihenfolge</code><a class="anchor" aria-label="anchor" href="#import-finale-reihenfolge"></a>
</h5>
<p>First you need to import the Excel file and select the proper sheet
for your data set (<code>lfb_allg</code> for example). The column
<code>Abschnitt</code> contains the subsection numbers and names, that
need to be separated later.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subsections</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getExcel.html">getExcel</a></span><span class="op">(</span><span class="st">"Q:\\BT2021\\BT\\90_Skalenhandbuch\\Reihenfolge_Variablen_final.xlsx"</span><span class="op">)</span></span>
<span><span class="va">subsections_lfb_allg</span> <span class="op">&lt;-</span> <span class="va">subsections</span><span class="op">$</span><span class="va">LFB_allg</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">subsections_lfb_allg</span><span class="op">)</span></span></code></pre></div>
<p>It might look like this:</p>
<p><img src="pictures%5Cvarinfo_subsections.png" style="width:100.0%"></p>
<p><code>Abschnitt</code> starts with the section name <em>1
Testdesign</em> then with the first subsection name <em>1.1
Identifikationsvariable</em> and then <code>NA</code>, then the next
subsections <em>1.2 Testgruppenmerkmale</em> and <em>1.3 Rotation</em>,
then the next section <em>2 Persönliche Angaben</em> and so on. We need
to clean up the table so we can match the correct subsection info to
each variable in <code>varinfo</code>.</p>
</div>
<div class="section level5">
<h5 id="remove-nassections-in-varname">Remove NAs/sections in <code>varName</code><a class="anchor" aria-label="anchor" href="#remove-nassections-in-varname"></a>
</h5>
<p>We need the section names that start with a single digit like
<em>1</em> later (see <a href="#structure">7. Structure</a>). The
<code>finale Reihenfolge</code> Excel added rows between sections, so
you have some <code>NA</code> entries in the column
<code>varName</code>, as well. To match the input for the subsections to
<code>varinfo</code> we need to delete those rows for now.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subsections_lfb_allg</span> <span class="op">&lt;-</span> <span class="va">subsections_lfb_allg</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">subsections_lfb_allg</span><span class="op">$</span><span class="va">varName</span><span class="op">)</span>,<span class="op">]</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="check-variables-1">Check Variables<a class="anchor" aria-label="anchor" href="#check-variables-1"></a>
</h5>
<p>Now we need to check if the variables in the final order file match
the ones in <code>varinfo</code>. It’s the same check like before,
except this time both variables should be exactly the same, so the
output should be <code>character(0)</code> both times. When you find any
mismatches report back to your supervisor.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">$</span><span class="va">lfb_allg</span><span class="op">$</span><span class="va">Var.Name</span>, <span class="va">subsections_lfb_allg</span><span class="op">$</span><span class="va">varName</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">subsections_lfb_allg</span><span class="op">$</span><span class="va">varName</span>, <span class="va">varinfo</span><span class="op">$</span><span class="va">lfb_allg</span><span class="op">$</span><span class="va">Var.Name</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="seperate-subsection-names-and-numbers">Seperate Subsection Names and Numbers<a class="anchor" aria-label="anchor" href="#seperate-subsection-names-and-numbers"></a>
</h5>
<p>We need the number of the subsection and their names separately, so
we can 1) check for duplicates and 2) transfer them in the respective
<code>varinfo</code> columns. The package <code>eatTools</code> has a
practical function for that: <code><a href="https://weirichs.github.io/eatTools/reference/halveString.html" class="external-link">halveString()</a></code> separates any
string at a specified separator into two strings. After each number
there’s a blank space, so that’s our separator. First we save our
<code>Abschnitt</code> column in a new vector, then we separate numbers
from names and save them in <code>sep</code>. It returns a data frame
with two columns, that we can name <em>subsec number</em> and <em>subsec
name</em>.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sep</span> <span class="op">&lt;-</span> <span class="va">subsections_lfb_allg</span><span class="op">$</span><span class="va">Abschnitt</span></span>
<span><span class="va">sep</span> <span class="op">&lt;-</span> <span class="fu">eatTools</span><span class="fu">::</span><span class="fu"><a href="https://weirichs.github.io/eatTools/reference/halveString.html" class="external-link">halveString</a></span><span class="op">(</span><span class="va">sep</span>, <span class="st">" "</span>, colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"subsec number"</span>, <span class="st">"subsec name"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then we can add these two new columns to the existing data frame with
<code><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind()</a></code> and check whether it worked with
<code><a href="https://rdrr.io/r/utils/View.html" class="external-link">View()</a></code>.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subsections_lfb_allg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">subsections_lfb_allg</span>, <span class="va">sep</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">subsections_lfb_allg</span><span class="op">)</span></span></code></pre></div>
<p>It should look something like this now:</p>
<p><img src="pictures%5Cvarinfo_subsections_sep.png" style="width:100.0%"></p>
</div>
<div class="section level5">
<h5 id="check-for-duplicates">Check for Duplicates<a class="anchor" aria-label="anchor" href="#check-for-duplicates"></a>
</h5>
<p>For some BTs the same data is collected for different subjects, so
they have the same subsection names (like <em>Selbstkonzept</em>
(self-concept)). Due to technical reasons each <strong>subsection name
has to be unique</strong> in the codebook. So it’s important to check
for duplicates and report back, if you find any. Be mindful of
<code>NA</code>s, as they are also seen as duplicated input.</p>
<p>Now that we have the subsection names by themselves, we can check for
duplicates in the column <code>subsec name</code>.
<code><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">anyDuplicated()</a></code> checks if there are any duplicates, at all.
If the output is <code>0</code>, there are no duplicates and you can go
the next step. If the output is any other number, it indicates the
position of the first duplicated entry in the column.
<code><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated()</a></code> returns a logical vector of all entries,
<code>TRUE</code> indicates duplicated entries.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">anyDuplicated</a></span><span class="op">(</span><span class="va">subsections_lfb_allg</span><span class="op">$</span><span class="va">`subsec name`</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">subsections_lfb_allg</span><span class="op">$</span><span class="va">`subsec name`</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">subsections_lfb_allg</span><span class="op">$</span><span class="va">`subsec name`</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">subsections_lfb_allg</span><span class="op">$</span><span class="va">`subsec name`</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="add-missing-subsections">Add Missing Subsections<a class="anchor" aria-label="anchor" href="#add-missing-subsections"></a>
</h5>
<p>Now we need to fill the <code>NA</code>s with the proper subsection
info, which is always the one above. The <code>NA</code>s in row 3 need
to say <em>1.1</em> and <em>Identifikationsvariable</em>, in row 8 it
should say <em>2.1</em> and <em>Soziodemografie</em>, etc.</p>
<p>This loop checks every entry in the new columns
<code>subsec number</code> and <code>subsec name</code> for
<code>NA</code>s, if it finds one it fills it with the input from the
entry before it. After the loop you should check the columns with
<code><a href="https://rdrr.io/r/utils/View.html" class="external-link">View()</a></code>: there shouldn’t be any <code>NA</code>s; the
numbers should match their names like in
<code>finale Reihenfolge</code>.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">subsections_lfb_allg</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">subsections_lfb_allg</span><span class="op">$</span><span class="va">`subsec number`</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">subsections_lfb_allg</span><span class="op">[</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">subsections_lfb_allg</span><span class="op">[</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">subsections_lfb_allg</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="change-varinfo-order">Change Varinfo Order<a class="anchor" aria-label="anchor" href="#change-varinfo-order"></a>
</h5>
<p>Now we need adjust the order of <code>varinfo</code> to match the
final order. This only works, if the variables of both data frames are
exactly the same like we checked before (see <a href="#check-variables">Check Variables</a>).</p>
<p>We use the <code><a href="https://rdrr.io/r/base/match.html" class="external-link">match()</a></code> function again, but this time, we
save the changed order into the <code>varinfo</code> list. The first
object needs to be the variables in the order we want from
<code>finale Reihenfolge</code>, the second the object we want to
change. You can check again with <code><a href="https://rdrr.io/r/utils/View.html" class="external-link">View()</a></code>.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">order_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">subsections_lfb_allg</span><span class="op">$</span><span class="va">varName</span>, <span class="va">varinfo</span><span class="op">$</span><span class="va">lfb_allg</span><span class="op">$</span><span class="va">Var.Name</span><span class="op">)</span></span>
<span><span class="va">varinfo</span><span class="op">$</span><span class="va">lfb_allg</span> <span class="op">&lt;-</span> <span class="va">varinfo</span><span class="op">$</span><span class="va">lfb_allg</span><span class="op">[</span><span class="va">order_new</span>,<span class="op">]</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="add-subsection-names-and-numbers-in-varinfo">Add Subsection Names and Numbers in <code>varinfo</code><a class="anchor" aria-label="anchor" href="#add-subsection-names-and-numbers-in-varinfo"></a>
</h5>
<p>Now that we cleaned up the table we got from
<code>finale Reihenfolge</code>, we have a data frame with the variable
names and their matching subsection numbers and names, as well as the
respective data frame from <code>varinfo</code> with a matched order, we
can finally transfer the subsection info into <code>varinfo</code>.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">varinfo</span><span class="op">$</span><span class="va">lfb_allg</span><span class="op">$</span><span class="va">Unterteilung.im.Skalenhandbuch</span> <span class="op">&lt;-</span> <span class="va">subsections_lfb_allg</span><span class="op">$</span><span class="va">`subsec name`</span></span>
<span><span class="va">varinfo</span><span class="op">$</span><span class="va">lfb_allg</span><span class="op">$</span><span class="va">Gliederung</span> <span class="op">&lt;-</span> <span class="va">subsections_lfb_allg</span><span class="op">$</span><span class="va">`subsec number`</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">$</span><span class="va">lfb_allg</span><span class="op">)</span></span></code></pre></div>
<p>To compare <code>varinfo$lfb_allg</code> and
<code>subsections_lfb_allg</code> you can use any kind of check
functions used so far, but it should be the same.</p>
</div>
<div class="section level5">
<h5 id="matching-data">Matching Data<a class="anchor" aria-label="anchor" href="#matching-data"></a>
</h5>
<p>Matching data sets are created for technical reasons and don’t
contain a lot of variables. The BT rarely adds subsection info to the
Excel file, but due to technical reasons, they still need them. Because
they don’t have different subsections you can just edit the columns
<code>Gliederung</code> to <code>1.1</code> and
<code>Unterteilung.im.Skalenhandbuch</code> to
<code>Matchingvariable</code>, unless you are told to do otherwise.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">varinfo</span><span class="op">$</span><span class="va">match</span><span class="op">$</span><span class="va">Unterteilung.im.Skalenhandbuch</span> <span class="op">&lt;-</span> <span class="st">"Matchingvariablen"</span></span>
<span><span class="va">varinfo</span><span class="op">$</span><span class="va">match</span><span class="op">$</span><span class="va">Gliederung</span> <span class="op">&lt;-</span> <span class="st">"1.1"</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="adjust-titles">Adjust Titles<a class="anchor" aria-label="anchor" href="#adjust-titles"></a>
</h5>
<p>The variable’s labels cannot be changed, because they have to match
the data sets. They usually don’t contain umlauts or other special
characters. The titles have the same input as the labels per
default.</p>
<p><code>Titel</code> (titles) are shown in the table of content, it’s
nice to have proper (German) spelling here, so you can adjust it by
reading in the additional <code>Titel</code> column in the Excel file,
if you have that. This column contains spelling with umlauts, ß or other
special characters. After you changed the order of <code>varinfo</code>
to match the final order, you can just transfer the column in
<code>varinfo$data$Titel</code> like you did with the subsection
info.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">varinfo</span><span class="op">$</span><span class="va">lfb_allg</span><span class="op">$</span><span class="va">Titel</span> <span class="op">&lt;-</span> <span class="va">subsections_lfb_allg</span><span class="op">$</span><span class="va">`Titel.(Ebene.3)`</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="save-progress-1">Save Progress<a class="anchor" aria-label="anchor" href="#save-progress-1"></a>
</h5>
<p>When everything matched correctly, save your progress and import the
Excel with <code><a href="../reference/getVarInfo.html">getVarInfo()</a></code>.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/writeExcel.html">writeExcel</a></span><span class="op">(</span>df_list <span class="op">=</span> <span class="va">varinfo</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, filePath <span class="op">=</span> <span class="st">".\\07_SH_Erstellung\\varinfo_edited.xlsx"</span><span class="op">)</span></span>
<span><span class="va">varinfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getVarInfo.html">getVarInfo</a></span><span class="op">(</span><span class="st">".\\07_SH_Erstellung\\varinfo_edited.xlsx"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="add-recoded-info">Add Recoded Info<a class="anchor" aria-label="anchor" href="#add-recoded-info"></a>
</h4>
<p>Each variable page shows the info whether or not a variable has been
recoded (<code>ja</code>) or not (<code>nein</code>). You recognize the
recoded variables by the ending <code>_r</code> in their name. This loop
looks through all data frames in <code>varinfo</code> in the column
<code>Var.Name</code>. If it finds the ending <code>_r</code>, it writes
<code>ja</code> in the column <code>rekodiert</code> for the respective
variable. That is all. This changes all data frames in
<code>varinfo</code>.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">varinfo</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">rekodiert</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"*_r"</span>, <span class="va">varinfo</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Var.Name</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"ja"</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>You can check if it worked with the following line (for each data
frame separately):</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">varinfo</span><span class="op">$</span><span class="va">lfb_allg</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<div class="section level5">
<h5 id="save-progress-2">Save Progress<a class="anchor" aria-label="anchor" href="#save-progress-2"></a>
</h5>
<p>When everything turned out correct, save your progress and import the
Excel with <code><a href="../reference/getVarInfo.html">getVarInfo()</a></code>.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/writeExcel.html">writeExcel</a></span><span class="op">(</span>df_list <span class="op">=</span> <span class="va">varinfo</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, filePath <span class="op">=</span> <span class="st">".\\07_SH_Erstellung\\varinfo_edited.xlsx"</span><span class="op">)</span></span>
<span><span class="va">varinfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getVarInfo.html">getVarInfo</a></span><span class="op">(</span><span class="st">".\\07_SH_Erstellung\\varinfo_edited.xlsx"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="add-background-model-info">Add Background Model Info<a class="anchor" aria-label="anchor" href="#add-background-model-info"></a>
</h4>
<p>The background model (BGM) info is something to do for all data
frames at once, as well. This info will later show up in the appendix of
the codebook, not on the individual pages of the variables. You should
do this after changing <code>varinfo</code> to match the final order,
especially for the column <code>Reihenfolge.HGM</code>. The order of the
variables in the BGM appendix should either match the one in the
codebook or you group them by name. Ask your supervisor what they
prefer. You need to do the following steps:</p>
<blockquote>
<ul>
<li>Import the Excel from <code>Q:</code>
</li>
<li>Add new variables to <code>varinfo</code> if needed</li>
<li>Add background model info to <code>varinfo</code>
</li>
</ul>
</blockquote>
<div class="section level5">
<h5 id="import-excel">Import Excel<a class="anchor" aria-label="anchor" href="#import-excel"></a>
</h5>
<p>For the BT studies, you will need access to an Excel file containing
all the relevant information about the background model somewhere on
<code>Q:</code>. Don’t forget to adjust the file path. There’s one sheet
with a lot of columns, but you only need 3 or 4 of them:
<code>Variablenname</code>, <code>basevar</code> , <code>HGM</code> and
maybe <code>Variablenlabel</code>. <code>basevar</code> contains the
info out of which variables a variable was constructed, but for most
variables this columns is empty. <code>HGM</code> has either the value
<code>1</code> or <code>0</code>.</p>
<p>First you import the file and save it into a data frame.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bgm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getExcel.html">getExcel</a></span><span class="op">(</span><span class="st">"Q:\\BT2021\\BT\\51_Auswertung\\05_HGM\\05_VF_Imp2021\\variablen.xlsx"</span><span class="op">)</span></span></code></pre></div>
<p>Then you select these three columns and delete the rest in your data
frame in R and look at it. You only need the ones that have the entry
<code>1</code> in the column <code>HGM</code>.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bgm</span> <span class="op">&lt;-</span> <span class="va">bgm</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">16</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">bgm</span> <span class="op">&lt;-</span> <span class="va">bgm</span><span class="op">[</span><span class="va">bgm</span><span class="op">$</span><span class="va">HGM</span> <span class="op">==</span> <span class="fl">1</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">bgm</span><span class="op">)</span></span></code></pre></div>
<p>Before you can work with this data frame, you need to replace the
<code>NA</code>s in the column <code>basevar</code> with
<code>-</code>.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bgm</span><span class="op">$</span><span class="va">basevar</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">bgm</span><span class="op">$</span><span class="va">basevar</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"-"</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="add-new-bgm-variables-to-varinfo">Add New BGM Variables to <code>varinfo</code><a class="anchor" aria-label="anchor" href="#add-new-bgm-variables-to-varinfo"></a>
</h5>
<p>Before you add any BGM info to <code>varinfo</code>, you might have
to add a few variables to data frames that were created for the BGM.
These are not displayed in the codebook, but need to be listed in
<code>varinfo</code>, otherwise they won’t show up in the appendix.</p>
<p>For the BT21 there were variables created with the names
<code>X.klasse</code> for the student data, that were not in the data
set. You can identify these variables by using <code><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff()</a></code>.
If you find any variables in the BGM Excel that you can’t find in any of
the data frames, you probably have to add them yourself.</p>
<p>You start by identifying the variables in the new <code>hgm</code>
table, in the example all variables that end with <code>.klasse</code>
are extracted.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extracting .klasse variables, labels, and basevar</span></span>
<span><span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">".klasse"</span>, <span class="va">hgm</span><span class="op">$</span><span class="va">Variablenname</span><span class="op">)</span></span>
<span><span class="va">hgm_klasse</span> <span class="op">&lt;-</span> <span class="va">hgm</span><span class="op">[</span><span class="va">pos</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">hgm_klasse</span><span class="op">)</span></span></code></pre></div>
<p>Then you have to find out which data frame contains the originals.
You can use the <code>basebar</code> column for that. In this case there
are only individual variables listed, so that makes it easier to find.
You add a new column to the <code>hgm_klasse</code> data frame (called
<code>dat</code>). Then you search the variable names of all data frames
if they match an entry in <code>basevar</code> (the original variable)
and add the name of that data frame to the column <code>dat</code>.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hgm_klasse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">hgm_klasse</span>, dat <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">var</span> <span class="kw">in</span> <span class="va">hgm_klasse</span><span class="op">$</span><span class="va">basevar</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">var</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">varinfo</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Var.Name</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">hgm_klasse</span><span class="op">[</span><span class="va">hgm_klasse</span><span class="op">$</span><span class="va">basevar</span> <span class="op">==</span> <span class="va">var</span>,<span class="op">]</span><span class="op">$</span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In this case the original variables were all in the student data
(<code>sus</code>). So now you need to add new rows to the
<code>varinfo$sus</code> data frame. You need to add new empty rows to
<code>varinfo</code>. <code>pos</code> can give you the number of rows
you need to add.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pos</span><span class="op">)</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
<p>Then you fill in the empty lines with default setting like so:</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">$</span><span class="va">Var.Name</span><span class="op">)</span>,<span class="op">]</span><span class="op">$</span><span class="va">Var.Name</span> <span class="op">&lt;-</span> <span class="va">hgm_klasse</span><span class="op">$</span><span class="va">Variablenname</span></span>
<span></span>
<span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">[</span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">$</span><span class="va">Var.Name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">hgm_klasse</span><span class="op">$</span><span class="va">Variablenname</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">17</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"-"</span></span>
<span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">[</span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">$</span><span class="va">Var.Name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">hgm_klasse</span><span class="op">$</span><span class="va">Variablenname</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">9</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">hgm_klasse</span><span class="op">$</span><span class="va">Variablenlabel</span></span>
<span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">[</span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">$</span><span class="va">Var.Name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">hgm_klasse</span><span class="op">$</span><span class="va">Variablenname</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span>, <span class="fl">13</span>, <span class="fl">17</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"nein"</span></span>
<span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">[</span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">$</span><span class="va">Var.Name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">hgm_klasse</span><span class="op">$</span><span class="va">Variablenname</span>,<span class="op">]</span><span class="op">$</span><span class="va">Reihenfolge</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">[</span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">$</span><span class="va">Var.Name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">hgm_klasse</span><span class="op">$</span><span class="va">Variablenname</span>,<span class="op">]</span><span class="op">$</span><span class="va">Layout</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">[</span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">$</span><span class="va">Var.Name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">hgm_klasse</span><span class="op">$</span><span class="va">Variablenname</span>,<span class="op">]</span><span class="op">$</span><span class="va">Gliederung</span> <span class="op">&lt;-</span> <span class="st">"12"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">$</span><span class="va">sus</span><span class="op">)</span></span></code></pre></div>
<p>Make sure all variables were added and that the entries are correct.
They are not supposed to show up in the main codebook, so
<code>in.DS.und.SH</code> needs to say <code>nein</code> and they don’t
need any <code>Layout</code> information.</p>
</div>
<div class="section level5">
<h5 id="adding-bgm-info">Adding BGM Info<a class="anchor" aria-label="anchor" href="#adding-bgm-info"></a>
</h5>
<p>When you want to</p>
<p>With this loop you can identify the variables in the <code>BGM</code>
table and adjust the columns in the respective data frame in
<code>varinfo</code>. It works for all data frames at once. It sets the
<code>Hintergrundmoell</code> to <code>ja</code>, adds the order number
in <code>HGM.Reihenfolge</code> and the base variables in
<code>basevar</code>. You can check if the numbers are ascending from
first to last data frame with <code><a href="https://rdrr.io/r/utils/View.html" class="external-link">View()</a></code>.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">order</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">var</span> <span class="kw">in</span> <span class="va">varinfo</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Var.Name</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">var</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">bgm</span><span class="op">$</span><span class="va">Variablenname</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">varinfo</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">varinfo</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Var.Name</span> <span class="op">==</span> <span class="va">var</span>,<span class="op">]</span><span class="op">$</span><span class="va">Hintergrundmodell</span> <span class="op">&lt;-</span> <span class="st">"ja"</span></span>
<span>      <span class="va">varinfo</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">varinfo</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Var.Name</span> <span class="op">==</span> <span class="va">var</span>,<span class="op">]</span><span class="op">$</span><span class="va">HGM.Reihenfolge</span> <span class="op">&lt;-</span> <span class="va">order</span></span>
<span>      <span class="va">varinfo</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">varinfo</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Var.Name</span> <span class="op">==</span> <span class="va">var</span>,<span class="op">]</span><span class="op">$</span><span class="va">HGM.Variable.erstellt.aus</span> <span class="op">&lt;-</span> <span class="va">bgm</span><span class="op">[</span><span class="va">bgm</span><span class="op">$</span><span class="va">Variablenname</span> <span class="op">==</span> <span class="va">var</span>,<span class="op">]</span><span class="op">$</span><span class="va">basevar</span></span>
<span>      <span class="va">order</span> <span class="op">&lt;-</span> <span class="va">order</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively you can reorder the <code>bgm</code> object by adding
column <code>order</code> and give each variable the numerical order in
which they should show up in the appendix. Then you can use the
following loop:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">var</span> <span class="kw">in</span> <span class="va">varinfo</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Var.Name</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">var</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">bgm_order</span><span class="op">$</span><span class="va">Variablenname</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">varinfo</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">varinfo</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Var.Name</span> <span class="op">==</span> <span class="va">var</span>,<span class="op">]</span><span class="op">$</span><span class="va">Hintergrundmodell</span> <span class="op">&lt;-</span> <span class="st">"ja"</span></span>
<span>      <span class="va">varinfo</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">varinfo</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Var.Name</span> <span class="op">==</span> <span class="va">var</span>,<span class="op">]</span><span class="op">$</span><span class="va">HGM.Reihenfolge</span> <span class="op">&lt;-</span> <span class="va">bgm_order</span><span class="op">[</span><span class="va">bgm_order</span><span class="op">$</span><span class="va">Variablenname</span> <span class="op">==</span> <span class="va">var</span>,<span class="op">]</span><span class="op">$</span><span class="va">order</span></span>
<span>      <span class="va">varinfo</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">varinfo</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Var.Name</span> <span class="op">==</span> <span class="va">var</span>,<span class="op">]</span><span class="op">$</span><span class="va">HGM.Variable.erstellt.aus</span> <span class="op">&lt;-</span> <span class="va">bgm</span><span class="op">[</span><span class="va">bgm</span><span class="op">$</span><span class="va">Variablenname</span> <span class="op">==</span> <span class="va">var</span>,<span class="op">]</span><span class="op">$</span><span class="va">basevar</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="save-progress-3">Save Progress<a class="anchor" aria-label="anchor" href="#save-progress-3"></a>
</h5>
<p>When everything turned out correct, save your progress and import the
Excel with <code><a href="../reference/getVarInfo.html">getVarInfo()</a></code>.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/writeExcel.html">writeExcel</a></span><span class="op">(</span>df_list <span class="op">=</span> <span class="va">varinfo</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, filePath <span class="op">=</span> <span class="st">".\\07_SH_Erstellung\\varinfo_edited.xlsx"</span><span class="op">)</span></span>
<span><span class="va">varinfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getVarInfo.html">getVarInfo</a></span><span class="op">(</span><span class="st">".\\07_SH_Erstellung\\varinfo_edited.xlsx"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="add-remarks">Add Remarks<a class="anchor" aria-label="anchor" href="#add-remarks"></a>
</h4>
<p>If you have a list or Excel file with remarks and additions for
certain variables, you can add them similarly to the other information
above. If they are added in the <code>finale Reihenfolge</code> Excel in
the column <code>Kommentar</code>, you can add them with the subsection
info. If they are in a separate Excel you can match them item to item
like the BGM info.</p>
<div class="section level5">
<h5 id="save-progress-4">Save Progress<a class="anchor" aria-label="anchor" href="#save-progress-4"></a>
</h5>
<p>When everything turned out correct, save your progress and import the
Excel with <code><a href="../reference/getVarInfo.html">getVarInfo()</a></code>.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/writeExcel.html">writeExcel</a></span><span class="op">(</span>df_list <span class="op">=</span> <span class="va">varinfo</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, filePath <span class="op">=</span> <span class="st">".\\07_SH_Erstellung\\varinfo_edited.xlsx"</span><span class="op">)</span></span>
<span><span class="va">varinfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getVarInfo.html">getVarInfo</a></span><span class="op">(</span><span class="st">".\\07_SH_Erstellung\\varinfo_edited.xlsx"</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="structure">7. Structure<a class="anchor" aria-label="anchor" href="#structure"></a>
</h2>
<p>Now we create another Excel file that orders and names the sections
and subsections for the codebook.</p>
<div class="section level3">
<h3 id="about-the-structure">About the Structure<a class="anchor" aria-label="anchor" href="#about-the-structure"></a>
</h3>
<p>The function <code><a href="../reference/createStructure.html">createStructure()</a></code> will read the subsection
info from <code>varinfo</code> and create a new list list of data frames
(one for each data set) that needs to be saved to Excel, as well. You
still need to <strong>add the section names</strong> that we ignored
earlier. Again the BT might only give you section names for data sets
with content variables, so you might add them yourself for matching data
like before. #### Example Table</p>
<p>When we create a new <code>gliederung</code> with the info from
<code>varinfo</code> we get the following list of data frames:</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gliederung</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createStructure.html">createStructure</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">)</span></span></code></pre></div>
<p><img src=".%5Cpictures%5Cgliederung_list.png" style="width:100.0%"></p>
<p>The data frames should look like this: subsection names and numbers
from <code>varinfo</code> are added, but the section names with the full
numbers (1, 2, etc.) are empty. You need to add them for each data frame
separately.</p>
<p><img src=".%5Cpictures%5Cgliederung_sus.png" style="width:50.0%"></p>
</div>
<div class="section level3">
<h3 id="structure-to-do">Structure To-do<a class="anchor" aria-label="anchor" href="#structure-to-do"></a>
</h3>
<p>Open the next file called <strong>3_gliederung.R</strong>. You just
need to create the list, add the few names and save it to Excel.</p>
<div class="section level4">
<h4 id="setup-1">Setup<a class="anchor" aria-label="anchor" href="#setup-1"></a>
</h4>
<p>You need to do load the packages and the two Excel files
<code>varinfo_edited.xlsx</code> and the <code>finale Reihenfolge</code>
with the structure info we used before. The setup should already be in
the template file, you might need to adjust the path file of the
structure info Excel, though.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/beckerbenj/eatCodebook" class="external-link">eatCodebook</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/beckerbenj/eatGADS" class="external-link">eatGADS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/weirichs/eatTools" class="external-link">eatTools</a></span><span class="op">)</span></span>
<span><span class="co"># get varinfo</span></span>
<span><span class="va">varinfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getVarInfo.html">getVarInfo</a></span><span class="op">(</span><span class="st">".\\excel_files\\varinfo_edited.xlsx"</span><span class="op">)</span></span>
<span><span class="co"># get structure info</span></span>
<span><span class="va">subsections</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getExcel.html">getExcel</a></span><span class="op">(</span><span class="st">"Q:\\BT2021\\BT\\90_Skalenhandbuch\\Reihenfolge_Variablen_final.xlsx"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">subsections</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="create-structure-table">Create Structure Table<a class="anchor" aria-label="anchor" href="#create-structure-table"></a>
</h4>
<p>You create the new list with <code><a href="../reference/createStructure.html">createStructure()</a></code> and look
at it with <code><a href="https://rdrr.io/r/utils/View.html" class="external-link">View()</a></code>:</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gliederung</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createStructure.html">createStructure</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">gliederung</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="add-missing-section-names">Add Missing Section Names<a class="anchor" aria-label="anchor" href="#add-missing-section-names"></a>
</h4>
<p>Now you identify the sections for each data frame separately and add
the names to the new data frames.</p>
<p>The section rows don’t have variables, so you can <strong>identify
sections</strong> by their <code>NA</code> entries in
<code>varName</code> and save them in the object
<code>section_names</code>.</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">section_names</span> <span class="op">&lt;-</span> <span class="va">subsections</span><span class="op">$</span><span class="va">TR_SFB_EFB</span><span class="op">$</span><span class="va">Abschnitt</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">subsections</span><span class="op">$</span><span class="va">TR_SFB_EFB</span><span class="op">$</span><span class="va">varName</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>They have both section number and name, so you need to
<strong>separate</strong> that info like before:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sep</span> <span class="op">&lt;-</span> <span class="fu">eatTools</span><span class="fu">::</span><span class="fu"><a href="https://weirichs.github.io/eatTools/reference/halveString.html" class="external-link">halveString</a></span><span class="op">(</span><span class="va">section_names</span>, <span class="st">" "</span>, colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"number"</span>, <span class="st">"name"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>But now you only need the <code>name</code> info. You
<strong>add</strong> that to the empty spaces in
<code>gliederung</code>:</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gliederung</span><span class="op">$</span><span class="va">sus</span><span class="op">$</span><span class="va">Titel</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">gliederung</span><span class="op">$</span><span class="va">sus</span><span class="op">$</span><span class="va">Titel</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">sep</span><span class="op">[</span>, <span class="st">"name"</span><span class="op">]</span></span></code></pre></div>
<p><strong>Matching data</strong> probably won’t have any names in the
<code>finale Reihenfolge</code> Excel, so you add the name
<code>Matchingvariable</code> like before:</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gliederung</span><span class="op">$</span><span class="va">match</span><span class="op">$</span><span class="va">Titel</span> <span class="op">&lt;-</span> <span class="st">"Matchingvariablen"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="save-in-excel">Save in Excel<a class="anchor" aria-label="anchor" href="#save-in-excel"></a>
</h4>
<p>Then you save the <code>gliederung</code> list in Excel (one sheet
per data frame) and check for correct format with
<code><a href="../reference/getStructure.html">getStructure()</a></code>:</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/writeExcel.html">writeExcel</a></span><span class="op">(</span>df_list <span class="op">=</span> <span class="va">gliederung</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, filePath <span class="op">=</span> <span class="st">".\\excel_files\\gliederung.xlsx"</span><span class="op">)</span></span>
<span><span class="va">gliederung</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getStructure.html">getStructure</a></span><span class="op">(</span><span class="st">".\\excel_files\\gliederung.xlsx"</span><span class="op">)</span></span></code></pre></div>
<p>Then add the last line
<code>gliederung &lt;- getStructure(".\\excel_files\\gliederung.xlsx")</code>
to your <strong>0_main.R</strong> file.</p>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">8. References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>You need to create a separate Excel file with the references and
in-text citations if you want them to appear in the appendix.</p>
<div class="section level3">
<h3 id="about-references">About References<a class="anchor" aria-label="anchor" href="#about-references"></a>
</h3>
<p>Each variable page displays the in-text citations that you can look
up in the appendix. For that we need one data frame containing all
in-text citations and references used in the codebook (for the variables
and other texts).</p>
<p>The function <code><a href="../reference/createLitInfo.html">createLitInfo()</a></code> creates one data frame
containing all in-text citations form <code>varinfo</code>. You need to
match the actual references from the Excel files we used earlier. You
also need to add the intro references that you can get from an extra
Excel file.</p>
<p>The references should be in <a href="https://apastyle.apa.org/style-grammar-guidelines/references/examples" class="external-link">APA</a>
format, e.g. there should only be one continuous part of italic text per
reference in the Excel from the BT team, otherwise the function
<code>getAPAInfo()</code> might not work properly. This function adds
special LaTeX syntax for italic strings and URLs so they are displayed
correctly in the codebook.</p>
<blockquote>
<p>References in the Excel need to be in APA format!</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="references-to-do">References To-do<a class="anchor" aria-label="anchor" href="#references-to-do"></a>
</h3>
<p>You open <strong>4_literatur.R</strong>. You need the in-text
citation info from <code>varinfo</code> (<em>QuelleSH</em>) and the
references info from each of the Excel files used before, as well as the
intro reference Excel. You need to do the following steps:</p>
<blockquote>
<ul>
<li>Create the <code>litInfo</code> template from
<code>varinfo</code>
</li>
<li>Clean up duplicates and spelling</li>
<li>Import (data set) references from Excel files</li>
<li>Clean up duplicates and spelling</li>
<li>Add (data set) references to their in-text citations</li>
<li>Add intro references separately</li>
<li>Final clean up</li>
</ul>
</blockquote>
<div class="section level4">
<h4 id="setup-2">Setup<a class="anchor" aria-label="anchor" href="#setup-2"></a>
</h4>
<p>Make sure the packages and <code>varinfo</code> are loaded.</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/beckerbenj/eatCodebook" class="external-link">eatCodebook</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/beckerbenj/eatGADS" class="external-link">eatGADS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/weirichs/eatTools" class="external-link">eatTools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nacnudus/tidyxl" class="external-link">tidyxl</a></span><span class="op">)</span></span>
<span><span class="co"># get varinfo</span></span>
<span><span class="va">varinfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getVarInfo.html">getVarInfo</a></span><span class="op">(</span><span class="st">".\\excel_files\\varinfo_edited.xlsx"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="create-litinfo">Create <code>litInfo</code><a class="anchor" aria-label="anchor" href="#create-litinfo"></a>
</h4>
<p>Then we create a template data frame with all the in-text citations
in <code>varinfo</code>:</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">literatur</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createLitInfo.html">createLitInfo</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">)</span></span>
<span><span class="va">literatur</span></span></code></pre></div>
<p>The data frame as three columns: <strong>Kurzangabe</strong> for the
in-text citations (if you edited <code>varinfo</code> this column should
have several entries), <strong>Langangabe</strong> with the references
and <strong>in_Literaturverzeichnis</strong> which indicates whether the
reference should show up in the appendix (<code>ja</code>) or not
(<code>nein</code>).</p>
<p>If you want to save this template at this point you have to edit the
column <code>in_Literaturverzeichnis</code> to either contain the input
<code>ja</code> or <code>nein</code>. Otherwise the function
<code><a href="../reference/getLitInfo.html">getLitInfo()</a></code> will throw an error.</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">literatur</span><span class="op">$</span><span class="va">in_Literaturverzeichnis</span> <span class="op">&lt;-</span> <span class="st">"nein"</span></span>
<span><span class="co"># save to Excel</span></span>
<span><span class="fu"><a href="../reference/writeExcel.html">writeExcel</a></span><span class="op">(</span>df_list <span class="op">=</span> <span class="va">literatur</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, filePath <span class="op">=</span> <span class="st">".\\excel_files\\literatur.xlsx"</span><span class="op">)</span></span>
<span><span class="co"># import Excel</span></span>
<span><span class="va">literatur</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getLitInfo.html">getLitInfo</a></span><span class="op">(</span><span class="st">".\\excel_files\\literatur.xlsx"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="clean-up-in-text-citations">Clean up In-Text Citations<a class="anchor" aria-label="anchor" href="#clean-up-in-text-citations"></a>
</h4>
<p>The in-text citations might have additional info like <em>in
Anlehnung an</em> (based on). But they need to be according to APA,
e.g. just <em>Hertel et al. (2014)</em>. You need to make sure the
punctuation is right and that there are no additions.</p>
<p>If you used <code><a href="../reference/getLitInfo.html">getLitInfo()</a></code> you might have to adjust the
spelling of special characters like <code>&amp;</code> that were escaped
with <code>\</code> by the function. The <code>\</code> or
<code>\\</code> is added, because otherwise TeXWorks (a LaTeX program)
interprets characters like <code>&amp;</code> as a command. R will
display four backlashes when the Excel or table viewed with
<code><a href="https://rdrr.io/r/utils/View.html" class="external-link">View()</a></code> will display only two, that is why there are four
backslashes in the example.</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># remove latex syntax (if needed)</span></span>
<span><span class="va">literatur</span><span class="op">$</span><span class="va">Kurzangabe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\\\&amp;"</span>, <span class="st">"&amp;"</span>, <span class="va">literatur</span><span class="op">$</span><span class="va">Kurzangabe</span><span class="op">)</span></span>
<span><span class="co"># removes additions before the strings</span></span>
<span><span class="va">literatur</span><span class="op">$</span><span class="va">Kurzangabe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"^.*?in Anlehnung an "</span>,<span class="st">""</span>,<span class="va">literatur</span><span class="op">$</span><span class="va">Kurzangabe</span><span class="op">)</span></span>
<span><span class="va">literatur</span><span class="op">$</span><span class="va">Kurzangabe</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"^.*?In Anlehnung an "</span>,<span class="st">""</span>,<span class="va">literatur</span><span class="op">$</span><span class="va">Kurzangabe</span><span class="op">)</span></span></code></pre></div>
<p>When you look at the entries now, there should only be APA conform
in-text citations. You need to check whether all in-text citations 1)
have the <strong>proper format</strong> and 2) there’s only <strong>one
in-text citation per entry</strong>. When a variable has multiple
references they will show up in this table as one entry, e.g. <em>Wagner
et al. (2009); Henschel &amp; Roick (2017)</em>. You need to separate
them into two entries. You can identify them by the semicolon
<code>;</code>. We use the <code><a href="https://weirichs.github.io/eatTools/reference/halveString.html" class="external-link">halveString()</a></code> function to
separate these entries.</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">literatur</span><span class="op">)</span></span>
<span><span class="co"># example reference</span></span>
<span><span class="va">literatur</span><span class="op">$</span><span class="va">Kurzangabe</span> <span class="op">&lt;-</span> <span class="st">"Wagner et al. (2009); Henschel &amp; Roick (2017)"</span></span>
<span><span class="co"># identify multiple references</span></span>
<span><span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">";"</span>, <span class="va">literatur</span><span class="op">$</span><span class="va">Kurzangabe</span><span class="op">)</span></span>
<span><span class="co"># separate entries</span></span>
<span><span class="va">sep</span> <span class="op">&lt;-</span> <span class="fu">eatTools</span><span class="fu">::</span><span class="fu"><a href="https://weirichs.github.io/eatTools/reference/halveString.html" class="external-link">halveString</a></span><span class="op">(</span><span class="va">literatur</span><span class="op">$</span><span class="va">Kurzangabe</span><span class="op">[</span><span class="va">pos</span><span class="op">]</span>, <span class="st">"; "</span><span class="op">)</span></span>
<span><span class="co"># update original entry</span></span>
<span><span class="va">literatur</span><span class="op">$</span><span class="va">Kurzangabe</span><span class="op">[</span><span class="va">pos</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">sep</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co"># add new row</span></span>
<span><span class="va">literatur</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">literatur</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sep</span><span class="op">)</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sep</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="cn">NA</span>, <span class="st">"nein"</span><span class="op">)</span></span></code></pre></div>
<p>When variables from different data sets reference the same
publication, there will be <strong>duplicated</strong> entries that you
need to remove.</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">literatur</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">literatur</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="import-references">Import References<a class="anchor" aria-label="anchor" href="#import-references"></a>
</h4>
<p>Now you import the second sheet of the reference (Quellen) Excel
files that matched the references to the variables. The second sheet
contains all in-text citations used per data set and their references.
They should already have the right APA format (with italic parts). If we
use <code><a href="../reference/getExcel.html">getExcel()</a></code> like before this information will be lost.
So we use <code>getAPAInfo()</code> which imports the Excel data and
adds the proper LaTeX syntax for italic input
(<code>\textit{...}</code>) and URLs
(<code>\urlstyle{same}\url{...}</code>).</p>
<p>The <em>intro</em> to the codebook usually has separate references
that you have to add <em>later</em>.</p>
<p>Import the reference list with <code>getAPAInfo()</code>. It adds the
LaTeX syntax for italic text and URLs. It needs the
<code>file path</code> and the <code>sheet</code> number of the
reference list in the file. The default for the <code>sheet</code>
argument is <code>2</code>, as it is the use case for most BT reference
files. You recognize the reference list sheet by having two columns
called <code>Kurzangabe</code> and <code>Langangabe</code>.</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ref_lfb_allg</span> <span class="op">&lt;-</span> <span class="fu">getAPAInfo</span><span class="op">(</span><span class="st">"Q:\\BT2021\\BT\\90_Skalenhandbuch\\04_Instruktionen_Quellen\\LFB_allg_Instruktionen_Quellen_BT21.xlsx"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">ref_lfb_allg</span><span class="op">)</span></span></code></pre></div>
<p>When you view the imported reference list, italic parts should be
surrounded by <code>\textit{...}</code>, links should be surrounded by
<code>\urlstyle{same}\url{...}</code>. Be mindful that R displays two
backslashes in the console, but one when you use <code><a href="https://rdrr.io/r/utils/View.html" class="external-link">View()</a></code>.
It’s supposed to be this way.</p>
<p>You need to import the references for all data sets and save them in
one data frame.</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lit_ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind.data.frame</a></span><span class="op">(</span><span class="va">ref_sus</span>, <span class="va">ref_lfb_allg</span>, </span>
<span>                             <span class="va">ref_lfb_spez</span>, <span class="va">ref_slfb</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="adjust-references">Adjust References<a class="anchor" aria-label="anchor" href="#adjust-references"></a>
</h4>
<p>Then you also need to adjust this merged data frame. First we
<strong>remove additions</strong> from the in-text citations and
<strong>remove duplicates</strong>:</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># removes additions before the strings</span></span>
<span><span class="va">lit_ref</span><span class="op">$</span><span class="va">Kurzangabe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"^.*?in Anlehnung an "</span>,<span class="st">""</span>,<span class="va">lit_ref</span><span class="op">$</span><span class="va">Kurzangabe</span><span class="op">)</span></span>
<span><span class="va">lit_ref</span><span class="op">$</span><span class="va">Kurzangabe</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"^.*?In Anlehnung an "</span>,<span class="st">""</span>,<span class="va">lit_ref</span><span class="op">$</span><span class="va">Kurzangabe</span><span class="op">)</span></span>
<span><span class="co"># remove (real) duplicates</span></span>
<span><span class="va">lit_ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">lit_ref</span><span class="op">)</span></span></code></pre></div>
<p>Sometimes the format or spelling is slightly different in between
Excel files, so sometimes not all duplicate entries are deleted. Usually
it’s minor or obvious differences. For instance, when the italic string
starts with the first italic letter vs. the blank space before that. You
can <strong>identify duplicated in-text citations</strong> with
<code><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">anyDuplicated()</a></code>, if the output is <code>0</code> there are
no duplicates and you ignore the rest, otherwise you will get a table
with all duplicated entries. Then you can check the differences between
the references (<code>Langangaben</code>).</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># find duplicates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">anyDuplicated</a></span><span class="op">(</span><span class="va">lit_ref</span><span class="op">$</span><span class="va">Kurzangabe</span><span class="op">)</span></span>
<span><span class="co"># identify duplicates</span></span>
<span><span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">lit_ref</span><span class="op">$</span><span class="va">Kurzangabe</span><span class="op">)</span></span>
<span><span class="va">dup</span> <span class="op">&lt;-</span> <span class="va">lit_ref</span><span class="op">$</span><span class="va">Kurzangabe</span><span class="op">[</span><span class="va">pos</span><span class="op">]</span></span>
<span><span class="co"># look at duplicated entries</span></span>
<span><span class="va">lit_ref</span><span class="op">[</span><span class="va">lit_ref</span><span class="op">$</span><span class="va">Kurzangabe</span> <span class="op">==</span> <span class="va">dup</span>,<span class="op">]</span></span></code></pre></div>
<p>After identifying the duplicates you can look at them manually to
<strong>find out</strong> where the <strong>difference</strong> in the
references come from. If it’s minor differences, you can just delete the
extra ones. Sometimes the URL is missing, you should keep the reference
with the most amount of information.</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># delete all duplicates</span></span>
<span><span class="va">lit_ref</span> <span class="op">&lt;-</span> <span class="va">lit_ref</span><span class="op">[</span><span class="op">!</span><span class="va">pos</span>,<span class="op">]</span></span>
<span><span class="co"># delete specific rows example</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">lit_ref</span><span class="op">)</span></span>
<span><span class="va">lit_ref</span> <span class="op">&lt;-</span> <span class="va">lit_ref</span><span class="op">[</span><span class="op">-</span><span class="fl">21</span>,<span class="op">]</span></span></code></pre></div>
<p>Then you test once more, if there are any duplicates left, the output
should be <code>0</code>.</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">anyDuplicated</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">lit_ref</span><span class="op">)</span><span class="op">$</span><span class="va">Kurzangabe</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="match-in-text-citations-and-references">Match In-Text Citations and References<a class="anchor" aria-label="anchor" href="#match-in-text-citations-and-references"></a>
</h4>
<p>Now you have two data frames: <strong>literatur</strong> contains all
in-text citations actually used in <code>varinfo</code> and
<strong>lit_long</strong> containing the both in-text citations and
their references. Now you need to transfer the references to
<strong>literatur</strong>.</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">literatur</span><span class="op">$</span><span class="va">Kurzangabe</span>, <span class="va">lit_ref</span><span class="op">$</span><span class="va">Kurzangabe</span><span class="op">)</span></span>
<span><span class="va">literatur</span><span class="op">$</span><span class="va">Langangabe</span> <span class="op">&lt;-</span> <span class="va">lit_ref</span><span class="op">$</span><span class="va">Langangabe</span><span class="op">[</span><span class="va">pos</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">literatur</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="add-intro-references">Add Intro References<a class="anchor" aria-label="anchor" href="#add-intro-references"></a>
</h4>
<p><code>literatur</code> only has the in-text citations listed that
were used in <code>varinfo</code>. we can’t match references when they
are not listed. So now we add additional references like the ones used
in the intro or other texts.</p>
<p>First we <strong>import the intro references</strong> using
<code>getAPAInfo()</code> to get a data frame including LaTeX syntax for
the italic text parts. Don’t forget to check which page the reference
list is on.</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ref_intro</span> <span class="op">&lt;-</span> <span class="fu">getAPAInfo</span><span class="op">(</span><span class="st">"Q:\\filepath\\Intro_Quellen.xlsx"</span>, sheet <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>The data frame has probably two columns (<code>Kurzangabe</code> and
<code>Langangabe</code>), but we need the third column
<code>in_Literaturverzeichnis</code> so we can combine the two data
frames <code>ref_intro</code> and <code>literatur</code>. So we add the
additional column and set the input to <code>ja</code>, because all
references we add from this Excel should show up in the codebook.</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ref_intro</span><span class="op">$</span><span class="va">in_Literaturverzeichnis</span> <span class="op">&lt;-</span> <span class="st">"ja"</span></span></code></pre></div>
<p>Now we can just combine the two data frames and check if everything
worked with <code><a href="https://rdrr.io/r/utils/View.html" class="external-link">View()</a></code>.</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">literatur</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">literatur</span>, <span class="va">ref_intro</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">literatur</span><span class="op">)</span></span></code></pre></div>
<p>If there are any duplicates, you should remove them like before. You
can also check for duplicates with <code><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">anyDuplicated()</a></code> to make
sure.</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">literatur</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">literatur</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">anyDuplicated</a></span><span class="op">(</span><span class="va">literatur</span><span class="op">)</span> <span class="co"># should be 0</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="clean-up-table">Clean Up Table<a class="anchor" aria-label="anchor" href="#clean-up-table"></a>
</h4>
<p>After you transferred all the references correctly, you still need to
decide which references should be displayed in the codebook and change
the order to be <strong>alphabetical</strong>. Every entry with a proper
reference should be displayed and set to <code>ja</code>.</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># in Literaturverzeichnis</span></span>
<span><span class="va">literatur</span><span class="op">$</span><span class="va">in_Literaturverzeichnis</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">literatur</span><span class="op">$</span><span class="va">Langangabe</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"ja"</span></span>
<span><span class="co"># alphabetical order</span></span>
<span><span class="va">literatur</span> <span class="op">&lt;-</span> <span class="va">literatur</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">literatur</span><span class="op">$</span><span class="va">Kurzangabe</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">literatur</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="save-to-excel-1">Save to Excel<a class="anchor" aria-label="anchor" href="#save-to-excel-1"></a>
</h4>
<p>You can check once more whether everything is displayed the way you
want it to. Then save it to Excel and import again with
<code><a href="../reference/getLitInfo.html">getLitInfo()</a></code> to check for format. <code><a href="../reference/makeLit.html">makeLit()</a></code>
converts the Excel table into the proper LaTeX syntax for the function
<code><a href="../reference/codebook.html">codebook()</a></code>.</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/writeExcel.html">writeExcel</a></span><span class="op">(</span><span class="va">literatur</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, filePath <span class="op">=</span> <span class="st">".\\excel_files\\literatur.xlsx"</span><span class="op">)</span></span>
<span><span class="va">literatur</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getLitInfo.html">getLitInfo</a></span><span class="op">(</span><span class="st">".\\excel_files\\literatur.xlsx"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">literatur_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeLit.html">makeLit</a></span><span class="op">(</span><span class="va">literatur</span><span class="op">)</span></span></code></pre></div>
<p>You should add the last line
<code>literatur_final &lt;- makeLit(literatur)</code> to your script in
<strong>0_main.R</strong>.</p>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="background-model">9. Background Model<a class="anchor" aria-label="anchor" href="#background-model"></a>
</h2>
<div class="section level3">
<h3 id="about-bgm">About BGM<a class="anchor" aria-label="anchor" href="#about-bgm"></a>
</h3>
<p>You can add a list of all variables relevant for the background model
in the appendix. For that you need to add the respective information in
<code>varinfo</code> in the columns <code>Hintergrundmodell</code>,
<code>HGM.Reihenfolge</code> and <code>HGM.Variable.erstellt.aus</code>
(see <a href="#background-model-hgm">6. Varinfo</a>). With that you can
create an object that adds the relevant info to the appendix that looks
like this:</p>
<p><br><img src="pictures/hgm.png" alt="hgm"><img src="pictures/hgm2.png" alt="hgm2"><br></p>
</div>
<div class="section level3">
<h3 id="bgm-to-do">BGM To-do<a class="anchor" aria-label="anchor" href="#bgm-to-do"></a>
</h3>
<p>You go back to <strong>0_main.R</strong>, make sure that
<code>varinfo</code> is loaded into your environment. Then you can just
create the background model info with this one line, no need to edit or
save anything:</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hgm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeBGM.html">makeBGM</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="cover">10. Cover<a class="anchor" aria-label="anchor" href="#cover"></a>
</h2>
<div class="section level3">
<h3 id="about-the-cover">About the Cover<a class="anchor" aria-label="anchor" href="#about-the-cover"></a>
</h3>
<p>You can create a cover in R, but previous BTs just created a word
document for the cover page that you need to save as a <strong>pdf
file</strong>. After you created the pdf file it’s easy to include it in
the codebook.</p>
<p>It’s usually two pages: an actual cover page with the institute’s
logos, the title and author names and a second one with license and
bibliography information. The BT team will give you either a pdf or a
word document that you render to pdf.</p>
</div>
<div class="section level3">
<h3 id="cover-to-do">Cover To-do<a class="anchor" aria-label="anchor" href="#cover-to-do"></a>
</h3>
<div class="section level4">
<h4 id="import-pdf">Import PDF<a class="anchor" aria-label="anchor" href="#import-pdf"></a>
</h4>
<p>You work in <strong>0_main.R</strong>. After saving the cover as a
pdf, you can save it in you GitHub work space in the folder
<code>Texte</code>. Then you save this string with the proper path file
in the object <code>pdf_cover</code> that we need later.</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pdf_cover</span> <span class="op">&lt;-</span> <span class="st">'\\includepdf[pages=-]{.\\Texte\\cover_page.pdf}'</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="create-a-cover">Create a Cover<a class="anchor" aria-label="anchor" href="#create-a-cover"></a>
</h4>
<p>Alternatively you can create your own cover in R with the function
<code><a href="../reference/makeCover.html">makeCover()</a></code>.</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cover</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeCover.html">makeCover</a></span><span class="op">(</span>logoFile <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                   maintitle <span class="op">=</span> <span class="st">"Study of Achievement"</span>,</span>
<span>                   subtitle <span class="op">=</span> <span class="st">"Codebook of Study of Achievement"</span>,</span>
<span>                   authors <span class="op">=</span> <span class="st">"Some Person"</span>,</span>
<span>                   addAuthors <span class="op">=</span> <span class="st">"With the help of some other persons"</span>,</span>
<span>                   schriftenreihe <span class="op">=</span> <span class="st">"Book 9 of Studies of Achievement"</span>,</span>
<span>                   bibinfo <span class="op">=</span> <span class="st">"test"</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="meta-data">11. Meta Data<a class="anchor" aria-label="anchor" href="#meta-data"></a>
</h2>
<div class="section level3">
<h3 id="about-meta-data">About Meta Data<a class="anchor" aria-label="anchor" href="#about-meta-data"></a>
</h3>
<p>The meta data is the information for the pdf file that you create at
the end of this vignette. It contains information about the
<em>title</em>, the <em>authors</em>, the <em>keywords</em> and the
<em>subject</em> of the pdf. When you work with adobe, you can find the
meta data under <code>Menü</code> and
<code>Dokumenteneigenschaften</code>:</p>
<p><img src="pictures/meta_data.png" style="width:60.0%"><img src="pictures/meta_data2.png" style="width:100.0%"></p>
<blockquote>
<p>The meta data should contain the following information:</p>
<ul>
<li>
<strong>Title</strong>: The title of the codebook</li>
<li>
<strong>Authors</strong>: The authors of the codebook and everyone
involved in creating the data for it in the order of the authors listed
on the cover page.</li>
<li>
<strong>Keywords</strong>: Apropriate keywords</li>
<li>
<strong>Subject</strong>: Apropriate subject</li>
</ul>
</blockquote>
</div>
<div class="section level3">
<h3 id="meta-data-to-do">Meta Data To-do<a class="anchor" aria-label="anchor" href="#meta-data-to-do"></a>
</h3>
<p>You work in <strong>0_main.R</strong>. You create a new data frame
template with <code><a href="../reference/createMetadata.html">createMetadata()</a></code> and add information on
title, author, keywords and subject.</p>
<div class="section level4">
<h4 id="create-table">Create Table<a class="anchor" aria-label="anchor" href="#create-table"></a>
</h4>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createMetadata.html">createMetadata</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="fill-in-table">Fill in Table<a class="anchor" aria-label="anchor" href="#fill-in-table"></a>
</h4>
<p>You add the following four lines to the <code>meta</code> table. You
can probably copy last BT’s meta data and adjust the year and the
authors. It’s best to ask you supervisor or BT team what they want to be
written here.</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"Title"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"IQB-Bildungstrend~2021. Skalenhandbuch zur Dokumentation der Erhebungsinstrumente in den naturwissenschaftlichen F?chern und Mathematik"</span></span>
<span><span class="va">meta</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"Author"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Jule H. Burblies \\sep Edna Grewers \\sep Benjamin Becker \\sep Florian Enke \\sep Nicklas J. Hafiz \\sep Rebecca Schneider \\sep Karoline A. Sachse \\sep Sebastian Weirich \\sep Stefan Schipolowski"</span></span>
<span><span class="va">meta</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"Keywords"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Bildungstrend 2021\\sep IQB, Skalenhandbuch\\sep Erhebungsinstrumente Sekundarstufe I"</span></span>
<span><span class="va">meta</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"Subject"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Skalenhandbuch zum Bildungstrend 2021"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="save-to-excel-2">Save to Excel<a class="anchor" aria-label="anchor" href="#save-to-excel-2"></a>
</h4>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/writeExcel.html">writeExcel</a></span><span class="op">(</span><span class="va">meta</span>, <span class="st">".\\excel_files\\meta.xlsx"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="create-latex-syntax">Create LaTeX Syntax<a class="anchor" aria-label="anchor" href="#create-latex-syntax"></a>
</h4>
<p>After you created and saved the meta data to an Excel file, you read
from the Excel file with <code><a href="../reference/makeMetadata.html">makeMetadata()</a></code> to create the
proper LaTeX syntax for the codebook.</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeMetadata.html">makeMetadata</a></span><span class="op">(</span><span class="st">".\\excel_files\\meta.xlsx"</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="chapters">12. Chapters<a class="anchor" aria-label="anchor" href="#chapters"></a>
</h2>
<p>Now we still need to name the chapters properly.</p>
<div class="section level3">
<h3 id="about-chapters">About Chapters<a class="anchor" aria-label="anchor" href="#about-chapters"></a>
</h3>
<p>Each data set gets its own chapter. Each chapter has several sections
(1, 2, etc.) and several subsections (1.1, 1.2, etc.), each subsection
can have multiple variables. Previous BTs named the data sets like
this:</p>
<blockquote>
<ul>
<li>
<strong>sus</strong>: Schüler:innen</li>
<li>
<strong>lfb_allg</strong>: Lehrkräfte allgemein</li>
<li>
<strong>lfb_spez</strong>: Lehrkräfte lerngruppenspezifisch</li>
<li>
<strong>slfb</strong>: Schulleitungen</li>
<li>
<strong>match</strong>: Matching</li>
</ul>
</blockquote>
</div>
<div class="section level3">
<h3 id="chapters-to-do">Chapters To-do<a class="anchor" aria-label="anchor" href="#chapters-to-do"></a>
</h3>
<p>You work in <strong>0_main.R</strong>.</p>
<div class="section level4">
<h4 id="create-chapters">Create Chapters<a class="anchor" aria-label="anchor" href="#create-chapters"></a>
</h4>
<p><code><a href="../reference/createChapters.html">createChapters()</a></code> creates a data frame with the data from
<code>varinfo</code> with two columns: <code>dataName</code> contains
the names of the data frames of <code>varinfo</code> (like sus,
lfb_allg, etc.) which are not very intelligible.
<code>chapterName</code> is empty for now.</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chapters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createChapters.html">createChapters</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="edit-chapters">Edit Chapters<a class="anchor" aria-label="anchor" href="#edit-chapters"></a>
</h4>
<p>You just need to add the names in the second column. Make sure the
order matches the order of <code>dataName</code>.</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chapters</span><span class="op">$</span><span class="va">chapterName</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Schüler:innen"</span>, <span class="st">"Lehrkräfte allgemein"</span>, <span class="st">"Lehrkräfte lerngruppenspezifisch"</span>, </span>
<span>                          <span class="st">"Schulleitungen"</span>, <span class="st">"Matching"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="save-in-excel-1">Save in Excel<a class="anchor" aria-label="anchor" href="#save-in-excel-1"></a>
</h4>
<p>Then you need to save the data frame to Excel and import it again
with <code><a href="../reference/getChapters.html">getChapters()</a></code> to check the format.</p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/writeExcel.html">writeExcel</a></span><span class="op">(</span><span class="va">chapters</span>, <span class="st">".\\excel_files\\chapters.xlsx"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">chapters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getChapters.html">getChapters</a></span><span class="op">(</span><span class="st">".\\excel_files\\chapters.xlsx"</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="other-texts">13. Other Texts<a class="anchor" aria-label="anchor" href="#other-texts"></a>
</h2>
<p>There are two more optional files you can add to the
<code><a href="../reference/codebook.html">codebook()</a></code> function: <em>intro</em> and <em>lastpage</em>.
<strong>intro</strong> contains the intro text plus all the formatting
embedded in LaTeX code. <strong>lastpage</strong> contains the series of
publications.</p>
<div class="section level3">
<h3 id="about-intro">About Intro<a class="anchor" aria-label="anchor" href="#about-intro"></a>
</h3>
<p>You will probably get a Word file with the intro text and tables that
you need to convert to a .tex file with all the correct LaTeX code for
different parts of the intro like italic text parts, lists or graphics,
and footnotes, etc. You can find a example script in
<strong>5_latex_intro.R</strong>. You can also do it manually in
TexWorks, whatever works best for you. Either way it can be a lot of
work.</p>
</div>
<div class="section level3">
<h3 id="intro-to-do">Intro To-do<a class="anchor" aria-label="anchor" href="#intro-to-do"></a>
</h3>
<div class="section level4">
<h4 id="convert-text-into-latex-syntax">Convert Text into LaTeX Syntax<a class="anchor" aria-label="anchor" href="#convert-text-into-latex-syntax"></a>
</h4>
<p>If you open <strong>5_latex_intro.R</strong> you can find some
examples with which you can write your own script to convert the Word
document into the proper LaTeX code to save it as a .tex file. That will
take some time, so you can start with adapting the proper template even
before having the final or any version of the intro.</p>
<p>It’s important to save the proper LaTeX script version as a .tex
file, so you can just import add the code lines with
<code><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines()</a></code>.</p>
</div>
<div class="section level4">
<h4 id="import-intro">Import intro<a class="anchor" aria-label="anchor" href="#import-intro"></a>
</h4>
<p>If you saved your .tex file in the folder <em>Texte</em> in your work
space, you can add this line to <strong>0_main.R</strong> and
<strong>6_Erstellung_kurz.R</strong>.</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">intro_pages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="st">".\\Texte\\Latex_Intro.tex"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="about-lastpage">About Lastpage<a class="anchor" aria-label="anchor" href="#about-lastpage"></a>
</h3>
<p>The last pages of the codebook usually contains information about the
series of publications called <em>Schriftenreihe des Institutes zur
Qualitätsentwicklung im Bildungswesen</em> in the BT studies. It’s a
list of all codebooks from previous Bildungstrend studies:</p>
<p><img src=".%5Cpictures%5Clastpage_codebook.png"></p>
<p>You need a .tex file with the following beginning: the LaTeX setup
for the page, the title of the page in bold (<code>\textbf{}</code>),
and then all publications of the series.</p>
<p><img src=".%5Cpictures%5Clastpage_latex.png"><code>lastpage</code> are
the last pages in the codebook. There won’t be any mention of it in the
table of contents.</p>
</div>
<div class="section level3">
<h3 id="lastpage-to-do">Lastpage To-do<a class="anchor" aria-label="anchor" href="#lastpage-to-do"></a>
</h3>
<div class="section level4">
<h4 id="copy-last-years-publication-list">Copy Last Years Publication List<a class="anchor" aria-label="anchor" href="#copy-last-years-publication-list"></a>
</h4>
<p>You open the folder of last year’s BT on <code>Q:</code> and go to a
folder named <em>Texte</em> or <em>08_Einleitungstexte</em>. You copy
the file <code>Latex_lastpage.tex</code> or
<code>Latex_lastpage_snippet.tex</code> into your work space in the
folder <em>Texte</em>.</p>
</div>
<div class="section level4">
<h4 id="add-new-publication">Add New Publication<a class="anchor" aria-label="anchor" href="#add-new-publication"></a>
</h4>
<p>You open the file in TeXWorks and add the current publication you are
working on. You take the publication information from the cover file’s
second page:</p>
<p><img src=".%5Cpictures%5Clastpage_newSeries.png"></p>
<p>… and add this new <em>Band</em> to the .tex file. Be mindful of
escaping special characters like <code>&amp;</code> or umlauts. It
should look something like this:</p>
<p><img src=".%5Cpictures%5Clastpage_newSeries_latex.png"></p>
<p>Then save the file and name it <code>Latex_lastpage.tex</code>.</p>
</div>
<div class="section level4">
<h4 id="import-lastpage">Import <code>lastpage</code><a class="anchor" aria-label="anchor" href="#import-lastpage"></a>
</h4>
<p>If you saved your .tex file in the folder <em>Texte</em> in your work
space, you can add this line to <strong>0_main.R</strong> and
<strong>6_Erstellung_kurz.R</strong>.</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lastpage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="st">".\\Texte\\Latex_lastpage.tex"</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="create-the-codebook">14. Create the Codebook<a class="anchor" aria-label="anchor" href="#create-the-codebook"></a>
</h2>
<p>After you created and edited all the Excel files you can use
<code><a href="../reference/codebook.html">codebook()</a></code> to create a LaTeX script that you can save as a
.tex file. With that file you can render a pdf version of the
codebook.</p>
<div class="section level3">
<h3 id="about-the-codebook">About the Codebook<a class="anchor" aria-label="anchor" href="#about-the-codebook"></a>
</h3>
<p>You will probably have to create multiple codebook versions depending
on your progress and to check if variables and chapters or other
additions are displayed the way you want it to. There are arguments the
function <code><a href="../reference/codebook.html">codebook()</a></code> needs to create a minimal version of a
codebook. And additions that are not necessary, but that you need for
the BT codebook, like a reference list, a cover or an intro.</p>
<div class="section level4">
<h4 id="minimal-version">Minimal Version<a class="anchor" aria-label="anchor" href="#minimal-version"></a>
</h4>
<p>For the minimal version you need the data <code>datalist</code>, the
descriptives in <code>kennwerte</code>, the missings information
<code>missings</code>, the variable information (the core)
<code>varinfo</code>, and information about scales
<code>scaleInfo</code>, the structure <code>gliederung</code> and the
chapters <code>chapters</code>. So the command would look like this:</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">codebook</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/codebook.html">codebook</a></span><span class="op">(</span>varInfo <span class="op">=</span> <span class="va">varinfo</span>, missings <span class="op">=</span> <span class="va">missings</span>, struc <span class="op">=</span> <span class="va">gliederung</span>,</span>
<span>                     scaleInfo <span class="op">=</span> <span class="va">skalen</span>, register <span class="op">=</span> <span class="cn">NULL</span>, dat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">datalist</span>, <span class="fu">eatGADS</span><span class="fu">::</span><span class="va"><a href="https://beckerbenj.github.io/eatGADS/reference/extractData.html" class="external-link">extractData</a></span><span class="op">)</span>,</span>
<span>                     Kennwertedatensatz <span class="op">=</span> <span class="va">kennwerte</span>, chapters <span class="op">=</span> <span class="va">chapters</span><span class="op">)</span></span></code></pre></div>
<p>The information from <code>gliederung</code> and
<code>chapters</code> will create a <strong>table of contents</strong>
for the codebook.</p>
</div>
<div class="section level4">
<h4 id="additions">Additions<a class="anchor" aria-label="anchor" href="#additions"></a>
</h4>
<div class="section level5">
<h5 id="cover-1">Cover<a class="anchor" aria-label="anchor" href="#cover-1"></a>
</h5>
<p>The cover pages will show up in the beginning as the first two
pages.</p>
</div>
<div class="section level5">
<h5 id="intro-1">Intro<a class="anchor" aria-label="anchor" href="#intro-1"></a>
</h5>
<p>The intro will be displayed after the cover and the table of
contents. It will also be added to the table of contents.</p>
</div>
<div class="section level5">
<h5 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h5>
<p>The rest will show up in the appendix.</p>
<p>You can add a <strong>reference list</strong> with all references
that you saved to the Excel <code>literatur.xlsx</code>.</p>
<p>You can add the explanations from all statistical formulas and
<strong>abbreviations</strong> that you saved to
<code>abbr_list.xlsx</code>.</p>
<p>You can add the list of variables that were used for the
<strong>background model</strong> by extracting the info from
<code>varinfo</code> by using <code>makeBGM(varinfo)</code></p>
<p>You can add a <strong>lastpage</strong> that contains information
about the publication series.</p>
</div>
</div>
<div class="section level4">
<h4 id="versions">Versions<a class="anchor" aria-label="anchor" href="#versions"></a>
</h4>
<blockquote>
<p>While working on the Codebook, you will create different versions.
it’s best not to delete them, but save them in an <code>archive</code>
folder to compare different versions to one another if needed.</p>
</blockquote>
</div>
</div>
<div class="section level3">
<h3 id="codebook-to-do-in-r">Codebook To-do in R<a class="anchor" aria-label="anchor" href="#codebook-to-do-in-r"></a>
</h3>
<p>You open the file <strong>6_Erstellung_kurz.R</strong>. Here you will
find a template just for the creation of the codebook. You just import
or load all the data and files that you need to create the codebook, use
the function <code><a href="../reference/codebook.html">codebook()</a></code> to create a LaTeX script that you
then save as a <strong>.tex file</strong>. You can also create the
codebook in the <code>0_main.R</code> file, but there’s a lot of extra
code that might be confusing.</p>
<p>You will also need to create an <strong>extra file for the meta
data</strong> of the codebook.</p>
<div class="section level4">
<h4 id="load-all-necessary-files">Load All Necessary Files<a class="anchor" aria-label="anchor" href="#load-all-necessary-files"></a>
</h4>
<p>Here’s an overview over all the files you created with this vignette
that you need to create the codebook. Make sure that the packages
<code>eatCodebook</code> and <code>eatGADS</code> are loaded.</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load data</span></span>
<span><span class="va">data_sus</span>      <span class="op">&lt;-</span> <span class="fu">eatGADS</span><span class="fu">::</span><span class="fu"><a href="https://beckerbenj.github.io/eatGADS/reference/import_spss.html" class="external-link">import_spss</a></span><span class="op">(</span><span class="st">"Q:\\filepath\\Daten_sus.sav"</span><span class="op">)</span></span>
<span><span class="va">data_lfb_allg</span> <span class="op">&lt;-</span> <span class="fu">eatGADS</span><span class="fu">::</span><span class="fu"><a href="https://beckerbenj.github.io/eatGADS/reference/import_spss.html" class="external-link">import_spss</a></span><span class="op">(</span><span class="st">"Q:\\filepath\\Daten_lfb_allg.sav"</span><span class="op">)</span></span>
<span><span class="va">data_lfb_spez</span> <span class="op">&lt;-</span> <span class="fu">eatGADS</span><span class="fu">::</span><span class="fu"><a href="https://beckerbenj.github.io/eatGADS/reference/import_spss.html" class="external-link">import_spss</a></span><span class="op">(</span><span class="st">"Q:\\filepath\\Daten_lfb_spez.sav"</span><span class="op">)</span></span>
<span><span class="va">data_slfb</span>     <span class="op">&lt;-</span> <span class="fu">eatGADS</span><span class="fu">::</span><span class="fu"><a href="https://beckerbenj.github.io/eatGADS/reference/import_spss.html" class="external-link">import_spss</a></span><span class="op">(</span><span class="st">"Q:\\filepath\\Daten_slfb.sav"</span><span class="op">)</span></span>
<span><span class="va">datalist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sus <span class="op">=</span> <span class="va">data_sus</span>,</span>
<span>                 lfb_allg <span class="op">=</span> <span class="va">data_lfb_allg</span>, lfb_spez <span class="op">=</span> <span class="va">data_lfb_spez</span>,</span>
<span>                 slfb <span class="op">=</span> <span class="va">data_slfb</span><span class="op">)</span></span>
<span><span class="co"># descriptives</span></span>
<span><span class="va">kennwerte</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">".\\excel_files\\kennwerte.RDS"</span><span class="op">)</span></span>
<span><span class="va">input_descriptives</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">".\\excel_files\\input_descriptives.RDS"</span><span class="op">)</span></span>
<span><span class="co"># missings</span></span>
<span><span class="va">missings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getMissings.html">getMissings</a></span><span class="op">(</span><span class="st">".\\excel_files\\missings.xlsx"</span><span class="op">)</span></span>
<span><span class="co"># scales</span></span>
<span><span class="va">skalen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getScaleInfo.html">getScaleInfo</a></span><span class="op">(</span><span class="st">".\\excel_files\\skalen.xlsx"</span><span class="op">)</span></span>
<span><span class="co"># abbreviation list (optional)</span></span>
<span><span class="va">abbr_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeAbbrList.html">makeAbbrList</a></span><span class="op">(</span><span class="st">".\\excel_files\\abkürzung.xlsx"</span><span class="op">)</span></span>
<span><span class="co"># varinfo</span></span>
<span><span class="va">varinfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getVarInfo.html">getVarInfo</a></span><span class="op">(</span><span class="st">".\\excel_files\\varinfo_bearbeitet.xlsx"</span><span class="op">)</span></span>
<span><span class="co"># structure</span></span>
<span><span class="va">gliederung</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getStructure.html">getStructure</a></span><span class="op">(</span><span class="st">".\\excel_files\\gliederung.xlsx"</span><span class="op">)</span></span>
<span><span class="co"># references (optional)</span></span>
<span><span class="va">literatur_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeLit.html">makeLit</a></span><span class="op">(</span><span class="va">literatur</span><span class="op">)</span></span>
<span><span class="co"># background model (optional)</span></span>
<span><span class="va">hgm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeBGM.html">makeBGM</a></span><span class="op">(</span><span class="va">varinfo</span><span class="op">)</span></span>
<span><span class="co"># cover (optional)</span></span>
<span><span class="va">pdf_cover</span> <span class="op">&lt;-</span> <span class="st">'\\includepdf[pages=-]{.\\Texte\\cover_page.pdf}'</span></span>
<span><span class="co"># meta data</span></span>
<span><span class="va">meta_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeMetadata.html">makeMetadata</a></span><span class="op">(</span><span class="st">".\\excel_files\\meta.xlsx"</span><span class="op">)</span></span>
<span><span class="co"># chapters</span></span>
<span><span class="va">chapters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getChapters.html">getChapters</a></span><span class="op">(</span><span class="st">".\\excel_files\\chapters.xlsx"</span><span class="op">)</span></span>
<span><span class="co"># intro (optional)</span></span>
<span><span class="va">intro_pages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="st">".\\Texte\\Latex_Intro.tex"</span><span class="op">)</span></span>
<span><span class="co"># lastpage (optional)</span></span>
<span><span class="va">lastpage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="st">".\\Texte\\Latex_lastpage.tex"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="create-the-codebook-1">Create the Codebook<a class="anchor" aria-label="anchor" href="#create-the-codebook-1"></a>
</h4>
<p>Then you can use the function <code><a href="../reference/codebook.html">codebook()</a></code> to create the
LaTeX Script. This may take a while.</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">codebook</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/codebook.html">codebook</a></span><span class="op">(</span>varInfo <span class="op">=</span> <span class="va">varinfo</span>, missings <span class="op">=</span> <span class="va">missings</span>, struc <span class="op">=</span> <span class="va">gliederung</span>,</span>
<span>                     scaleInfo <span class="op">=</span> <span class="va">skalen</span>, register <span class="op">=</span> <span class="cn">NULL</span>, dat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">datenliste</span>, <span class="fu">eatGADS</span><span class="fu">::</span><span class="va"><a href="https://beckerbenj.github.io/eatGADS/reference/extractData.html" class="external-link">extractData</a></span><span class="op">)</span>,</span>
<span>                     Kennwertedatensatz <span class="op">=</span> <span class="va">kennwerte</span>,</span>
<span>                     chapters <span class="op">=</span> <span class="va">chapters</span>, deckblatt <span class="op">=</span> <span class="va">pdf_cover</span>, intro <span class="op">=</span> <span class="va">intro_pages</span>,</span>
<span>                     literatur <span class="op">=</span> <span class="va">literatur_final</span>, abkuerzverz <span class="op">=</span> <span class="va">abbr_list</span>, hintmod <span class="op">=</span> <span class="va">hgm</span>, lastpage <span class="op">=</span> <span class="va">lastpage</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="save-in-folder-latex">Save in Folder <code>Latex</code><a class="anchor" aria-label="anchor" href="#save-in-folder-latex"></a>
</h4>
<p>Save the object as a <code>.tex</code> file. You also have to save
the meta data you imported from the Excel file as a
<code>.xmpdata</code> file. Before saving the new files make sure to
adjust the date in the file path, so you know which one is the latest
version.</p>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save codebook as .tex</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.table</a></span><span class="op">(</span><span class="va">codebook_new</span>, file <span class="op">=</span> <span class="st">".\\Latex\\IQB_BT2021_Skalenhandbuch_Stand2025_04_03.tex"</span> , fileEncoding<span class="op">=</span><span class="st">"UTF-8"</span> ,</span>
<span>            col.names<span class="op">=</span><span class="cn">FALSE</span> , row.names<span class="op">=</span><span class="cn">FALSE</span> , quote <span class="op">=</span> <span class="cn">FALSE</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># save meta data as .xmpdata</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.table</a></span><span class="op">(</span><span class="va">meta_final</span> , file <span class="op">=</span> <span class="st">".\\Latex\\IQB_BT2021_Skalenhandbuch_Stand2025_04_03.xmpdata"</span>, fileEncoding<span class="op">=</span><span class="st">"UTF-8"</span> ,</span>
<span>            col.names<span class="op">=</span><span class="cn">FALSE</span> , row.names<span class="op">=</span><span class="cn">FALSE</span> , quote <span class="op">=</span> <span class="cn">FALSE</span> <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="codebook-to-do-in-texworks">Codebook To-do in TeXworks<a class="anchor" aria-label="anchor" href="#codebook-to-do-in-texworks"></a>
</h3>
<p>After you created the codebook and saved it as a .tex file, you still
need to render it as a pdf in <em>TeXWorks</em> or another LaTeX
software that you can download <a href="https://www.latex-project.org/get/" class="external-link">here</a>.</p>
<div class="section level4">
<h4 id="open--tex-file">Open .tex File<a class="anchor" aria-label="anchor" href="#open--tex-file"></a>
</h4>
<p>First you open the .tex file. You will have a very long script, but
you shouldn’t need to edit it. The first part of the script contains the
LaTeX packages that you need for the script and then all the input from
the Excel files that the function <code><a href="../reference/codebook.html">codebook()</a></code> converted to
the proper LaTeX code. The beginning might look like this:</p>
<p><img src=".%5Cpictures%5Ctex1.png" style="width:100.0%"></p>
</div>
<div class="section level4">
<h4 id="render-to-pdf-twice">Render To PDF (Twice)<a class="anchor" aria-label="anchor" href="#render-to-pdf-twice"></a>
</h4>
<p>You have to click the green triangle to render to pdf. Remember to
select the right option, so it says <em>pdfLaTeX</em>. It should render
(which can take a while) and create the a pdf with the same name as the
.tex file. It will also create some other new files that you can ignore.
This first version will not have a <em>table of contents</em>, but one
of the created files contains information about it. When you render to
pdf again (click the green triangle) the program creates a version with
a table of contents.</p>
<p><img src=".%5Cpictures%5Ctex_pdf.png" style="width:70.0%"></p>
</div>
<div class="section level4">
<h4 id="dealing-with-errors">Dealing with Errors<a class="anchor" aria-label="anchor" href="#dealing-with-errors"></a>
</h4>
<p>If the rendering doesn’t work you will get an error message in the
console of <em>TeXWorks</em> and the line that caused the error. You
might need to update the LaTeX packages. Most times the error is due to
syntax errors because special characters weren’t escaped properly in the
Excel files. Usually the errors can be fixed in R or by adjusting the
Excel files to contain proper LaTeX syntax.</p>
<div class="section level5">
<h5 id="update-latex-packages">Update LaTeX Packages<a class="anchor" aria-label="anchor" href="#update-latex-packages"></a>
</h5>
<p>To update the packages in <em>TeXWorks</em> you need to open your
MikTeX console.</p>
<p><img src=".%5Cpictures%5Cmiktex_console.png" style="width:50.0%"></p>
<p>It should open to a page where you can click on the button <em>nach
Updates suchen</em>.</p>
<p><img src=".%5Cpictures%5Cmiktex_updates.png" style="width:50.0%"></p>
<p>If all packages are up do date, nothing happens. Otherwise it should
look for updates and carry them out.</p>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Benjamin Becker, Sebastian Weirich, Felix Milles, Johanna Busse.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
